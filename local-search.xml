<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Pythonå¥‡æŠ€æ·«å·§(5)</title>
    <link href="/2022/09/02/Python%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7-5/"/>
    <url>/2022/09/02/Python%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7-5/</url>
    
    <content type="html"><![CDATA[<h2 id="æ–‡ä»¶å’Œio----æ¥æºäºcookbookç¬¬äº”ç« ">æ–‡ä»¶å’ŒIO----æ¥æºäºcookbookç¬¬äº”ç« </h2><span id="more"></span><p><font color="#a0add0">è®°å½•ç¬¬äº”ç« ä¸­æ¯”è¾ƒæœ‰æ„æ€çš„éƒ¨åˆ†</font></p><hr><h3 id="openå‡½æ•°æ‰“å¼€æ–‡ä»¶çš„å°æŠ€å·§">openå‡½æ•°æ‰“å¼€æ–‡ä»¶çš„å°æŠ€å·§</h3><div class="note note-primary">            <p>ç”±äºæœ‰äº›æ–‡ä»¶ä¸­ä¼šå‡ºç°ç¼–ç é”™è¯¯æˆ–ä¸å½“å‰ä¸»æœºä¸åŒ¹é…ï¼Œä½¿ç”¨<code>open</code>å‡½æ•°æ—¶å¯ä»¥å¢åŠ <code>errors='ignore'</code>æ¥å¿½ç•¥æ‰é”™è¯¯çš„ç¼–ç ã€‚</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>g = <span class="hljs-built_in">open</span>(<span class="hljs-string">"somefile.txt"</span>, <span class="hljs-string">'rt'</span>, encoding = <span class="hljs-string">'utf-8'</span>, errors = <span class="hljs-string">'ignore'</span>)<br><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨printå‡½æ•°é‡å®šå‘åˆ°æ–‡ä»¶">ä½¿ç”¨printå‡½æ•°é‡å®šå‘åˆ°æ–‡ä»¶</h3><div class="note note-primary">            <p>ä½¿ç”¨<code>print</code>å‡½æ•°çš„<code>file = handler</code>å‚æ•°å³å¯</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>l = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-string">'3'</span>,(<span class="hljs-number">4</span>,<span class="hljs-number">5</span>)]<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"file"</span>,<span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-built_in">print</span>(*l, sep = <span class="hljs-string">','</span>, file = f)<br><br></code></pre></td></tr></table></figure><h3 id="å¯¹ä¸å­˜åœ¨çš„æ–‡ä»¶è¿›è¡Œå†™å…¥æ“ä½œ">å¯¹ä¸å­˜åœ¨çš„æ–‡ä»¶è¿›è¡Œå†™å…¥æ“ä½œ</h3><div class="note note-primary">            <p>ç›´æ¥ä½¿ç”¨<code>xt</code>æ¨¡å¼æ¥æ“ä½œæ–‡ä»¶å³å¯</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"somefile"</span>, <span class="hljs-string">'wt'</span>) <span class="hljs-keyword">as</span> f: <span class="hljs-comment"># å½“somefileä¸å­˜åœ¨æ—¶ä¼šæŠ¥é”™</span><br>    ...<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"somefile"</span>, <span class="hljs-string">'xt'</span>) <span class="hljs-keyword">as</span> f: <span class="hljs-comment"># å½“somefileä¸å­˜åœ¨æ—¶ä¼šåˆ›å»ºï¼Œå­˜åœ¨æ—¶ä¸å½±å“</span><br>    ...<br><br></code></pre></td></tr></table></figure><h3 id="å°†äºŒè¿›åˆ¶æ–‡ä»¶åšå†…å­˜æ˜ å°„">å°†äºŒè¿›åˆ¶æ–‡ä»¶åšå†…å­˜æ˜ å°„</h3><div class="note note-primary">            <p>ä½¿ç”¨<code>mmap</code>æ¨¡å—æ¥åˆ›å»ºæ˜ å°„ï¼Œè¿™æ ·å¯ä»¥ç›´æ¥è®¿é—®ï¼Œè€Œä¸éœ€è¦é¢‘ç¹çš„seekã€readç­‰æ“ä½œã€‚</p><p>å¦å¤–ï¼Œç”±äºè™šæ‹Ÿå†…å­˜çš„å­˜åœ¨ï¼Œå¤šä¸ªpythonè§£é‡Šå™¨å¯ä»¥æ˜ å°„åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸Šä»è€Œå®ç°å…±äº«æ•°æ®ã€‚</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> mmap<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">memory_map</span>(<span class="hljs-params">filename, access = mmap.ACCESS_WRITE</span>):<br>    size = os.path.getsize(filename)<br>    fd = os.<span class="hljs-built_in">open</span>(filename, os.O_RDWR)<br>    <span class="hljs-keyword">return</span> mmap.mmap(fd, size, access = access)<br><br>m = memory_map(<span class="hljs-string">"data"</span>)<br><br><span class="hljs-comment"># æ­¤æ—¶å°±å¯ä»¥åƒæ“ä½œæ•°ç»„é‚£æ ·æ“ä½œm</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(m))<br><span class="hljs-built_in">print</span>(m[:<span class="hljs-number">34</span>])<br>m[:<span class="hljs-number">11</span>] = <span class="hljs-string">b'hello world'</span><br>m.close()<br><br></code></pre></td></tr></table></figure><h3 id="å°†å­—èŠ‚æ•°æ®å†™å…¥æ–‡æœ¬æ–‡ä»¶">å°†å­—èŠ‚æ•°æ®å†™å…¥æ–‡æœ¬æ–‡ä»¶</h3><div class="note note-primary">            <p>åªéœ€è¦ç®€ç­”çš„å°†å­—èŠ‚æ•°æ®å†™å…¥åˆ°æ–‡ä»¶åº•å±‚bufferä¸­å°±å¯ä»¥äº†ã€‚</p>          </div><div class="note note-warning">            <p>åœ¨pythonä¸­è°ƒç”¨printæ—¶ï¼Œäº‹å®ä¸Šè°ƒç”¨äº†sys.stdout.write(obj+'\n')</p><p>è€Œstdoutå°±åƒæ˜¯ä¸€ä¸ªç±»æ–‡ä»¶å¯¹è±¡ï¼Œå› ä¸ºä½ å¯ä»¥å°†ä»–èµ‹å€¼ç»™ä»»æ„çš„ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼Œé‡å®šå‘è¾“å‡º</p><p>åŸå§‹çš„sys.stdoutæŒ‡å‘æ§åˆ¶å°ï¼Œå¦‚æœæŠŠæ–‡ä»¶çš„å¯¹è±¡å¼•ç”¨èµ‹ç»™sys.stdoutï¼Œé‚£ä¹ˆprintè°ƒç”¨çš„å°±æ˜¯æ–‡ä»¶å¯¹è±¡çš„writeæ–¹æ³•</p><p>è€Œbufferæ˜¯ç¼“å†²åŒºï¼Œæ‰€ä»¥æ­¤æ“ä½œå°±æ˜¯ä¸è°ƒç”¨ä¸Šå±‚çš„writeæ–¹æ³•è€Œç›´æ¥å†™å…¥åº•å±‚çš„ç¼“å†²åŒº</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment"># ç¤ºä¾‹ä¸€</span><br><br><span class="hljs-keyword">import</span> sys<br><br>sys.stdout.buffer.write(<span class="hljs-string">b'hello\n'</span>)<br><br><br><span class="hljs-comment"># ç¤ºä¾‹äºŒ</span><br><br><span class="hljs-keyword">import</span> sys<br><br>sys.stdout = <span class="hljs-built_in">open</span>(<span class="hljs-string">"filename"</span>,<span class="hljs-string">"xt"</span>)<br><br>sys.stdout.buffer.write(<span class="hljs-string">b'hello\n'</span>)<br><br></code></pre></td></tr></table></figure><h3 id="åˆ›å»ºä¸´æ—¶æ–‡ä»¶ä¸æ–‡ä»¶å¤¹">åˆ›å»ºä¸´æ—¶æ–‡ä»¶ä¸æ–‡ä»¶å¤¹</h3><div class="note note-primary">            <p><code>tempfile</code>æ¨¡å—ä¸­æœ‰å„ç§å®ç°äº†ä¸Šä¸‹æ–‡ç®¡ç†åè®®çš„å‡½æ•°æ¥å¤„ç†ä¸´æ—¶æ–‡ä»¶</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> tempfile <span class="hljs-keyword">import</span> TemporaryFile<br><br><span class="hljs-keyword">with</span> TemporaryFile(<span class="hljs-string">'w+t'</span>, encoding = <span class="hljs-string">'utf-8'</span>, errors = <span class="hljs-string">'ignore'</span>, delete = <span class="hljs-literal">True</span>):<br>    ...<br><br></code></pre></td></tr></table></figure><h3 id="åºåˆ—åŒ–pythonå¯¹è±¡">åºåˆ—åŒ–pythonå¯¹è±¡</h3><div class="note note-primary">            <p><code>pickle</code>æ¨¡å—çš„dumpå’Œloadå‡½æ•°å°±è¶³ä»¥å¤„ç†è¿™äº›</p>          </div><div class="note note-warning">            <p>æ³¨æ„ä¸è¦å¯¹æ¥æºä¸æ˜çš„å¯¹è±¡è¿›è¡Œloadï¼Œå› ä¸ºè¿™ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œä¸¥é‡ç”šè‡³å¯èƒ½å¯¼è‡´è®¡ç®—æœºè¢«å…¥ä¾µã€‚</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> pickle<br><br>a = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"filename"</span>,<span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<br>    pickle.dump(a,f)<br>    ...<br>    pickle.load(a,f)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonæŠ€å·§</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>PythonCookbook</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Webbenchæºç å‰–æ</title>
    <link href="/2022/09/01/Webbench%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/"/>
    <url>/2022/09/01/Webbench%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="webbenchæºç å‰–æ">Webbenchæºç å‰–æ</h2><span id="more"></span><p><a href="https://github.com/EZLippi/WebBench">é¡¹ç›®åœ°å€</a></p><div class="note note-primary">            <h3 id="webbenchä»‹ç»">Webbenchä»‹ç»</h3><p>Webbenchæ˜¯ä¸€ä¸ªåœ¨linuxä¸‹ä½¿ç”¨çš„éå¸¸ç®€å•çš„ç½‘ç«™å‹æµ‹å·¥å…·ã€‚å®ƒä½¿ç”¨fork()æ¨¡æ‹Ÿå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®æˆ‘ä»¬è®¾å®šçš„URLï¼Œæµ‹è¯•ç½‘ç«™åœ¨å‹åŠ›ä¸‹å·¥ä½œçš„æ€§èƒ½ï¼Œæœ€å¤šå¯ä»¥æ¨¡æ‹Ÿ3ä¸‡ä¸ªå¹¶å‘è¿æ¥å»æµ‹è¯•ç½‘ç«™çš„è´Ÿè½½èƒ½åŠ›ã€‚</p><p>è€Œå…¶æºç ä¹Ÿç›¸å½“çš„çŸ­ï¼Œåªæœ‰500è¡Œï¼Œè¯»èµ·æ¥éå¸¸å®¹æ˜“ã€‚</p>          </div><p>ä¸è¿‡è™½ç„¶ä»£ç é‡å¾ˆå°ï¼Œä½†æ˜¯æœ€å¥½ç†Ÿæ‚‰unixç½‘ç»œç¼–ç¨‹ï¼Œä»¥åŠlinuxä¸‹Cè¯­è¨€å¤šçº¿ç¨‹çš„å®ç°(fork()å‡½æ•°)ï¼Œå¦åˆ™å¯èƒ½çœ‹èµ·æ¥ä¼šæ¯”è¾ƒåƒåŠ›ã€‚</p><p>æˆ‘ä»¬å°†ä»£ç æ‹‰ä¸‹æ¥åï¼Œå¯ä»¥å‘ç°ï¼Œå…¶åªåŒ…å«ä¸¤ä¸ªæ–‡ä»¶ï¼Œ</p>]]></content>
    
    
    <categories>
      
      <category>å°å‹Cè¯­è¨€é¡¹ç›®æºç å‰–æ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C</tag>
      
      <tag>å°å‹Cè¯­è¨€é¡¹ç›®æºç å‰–æ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonå¥‡æŠ€æ·«å·§(4)</title>
    <link href="/2022/08/30/Python%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7-4/"/>
    <url>/2022/08/30/Python%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7-4/</url>
    
    <content type="html"><![CDATA[<h2 id="è¿­ä»£å™¨----æ¥æºäºcookbookç¬¬å››ç« ">è¿­ä»£å™¨----æ¥æºäºcookbookç¬¬å››ç« </h2><span id="more"></span><p><font color="#add0a0">è®°å½•ç¬¬å››ç« ä¸­æ¯”è¾ƒæœ‰æ„æ€çš„éƒ¨åˆ†</font></p><hr><h3 id="å®ç°å®¹å™¨çš„å§”æ‰˜è¿­ä»£">å®ç°å®¹å™¨çš„å§”æ‰˜è¿­ä»£</h3><div class="note note-primary">            <p>åªéœ€è¦ä¸ºå®¹å™¨å®ç°<code>__iter__</code>é­”æ³•æ–¹æ³•å³å¯ã€‚</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,value</span>):<br>        self._value = value<br>        self._children = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__repr__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"Node({!r})"</span>.<span class="hljs-built_in">format</span>(self._value)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_child</span>(<span class="hljs-params">self,value</span>):<br>        self._children.append(value)<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">iter</span>(self._children)<br><br>a = Node(<span class="hljs-string">"list"</span>)<br>a.append(<span class="hljs-number">1</span>)<br>a.append(<span class="hljs-number">2</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a:<br>    <span class="hljs-built_in">print</span>(i,end=<span class="hljs-string">""</span>) <span class="hljs-comment">## 12</span><br><br></code></pre></td></tr></table></figure><h3 id="ç®€å•çš„æ–¹æ³•å®ç°è¿­ä»£åè®®">ç®€å•çš„æ–¹æ³•å®ç°è¿­ä»£åè®®</h3><div class="note note-primary">            <p>ä½¿ç”¨<code>yield from</code>å³å¯</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen</span>():<br>    x = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]<br>    <span class="hljs-comment"># æ³¨æ„ï¼Œæ­¤å¤„yieldå‡ºå»çš„ä»ç„¶æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œ</span><br>    <span class="hljs-keyword">yield</span> (i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> x <span class="hljs-keyword">if</span> i &gt; <span class="hljs-number">3</span>)<br><br>a = gen()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a:<br>    <span class="hljs-built_in">print</span>(i) <span class="hljs-comment"># &lt;generator object gen.&lt;locals&gt;.&lt;genexpr&gt; at 0x000001C6FC019D60&gt;</span><br><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen_good</span>():<br>    x = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]<br>    <span class="hljs-comment"># æ­¤æ—¶yieldå‡ºå»çš„æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•´æ•°</span><br>    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> (i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> x <span class="hljs-keyword">if</span> i &gt; <span class="hljs-number">3</span>)<br><br>a = gen()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a:<br>    <span class="hljs-built_in">print</span>(i) <span class="hljs-comment"># 4 5</span><br><br></code></pre></td></tr></table></figure><h3 id="åå‘è¿­ä»£">åå‘è¿­ä»£</h3><div class="note note-primary">            <p>åªéœ€è¦å®ç°<code>__reversed__()</code>æ–¹æ³•å³å¯ï¼Œå®ç°åå‘è¿­ä»£åçš„æ•ˆç‡æ›´é«˜</p>          </div><h3 id="è¿­ä»£å™¨åˆ‡ç‰‡">è¿­ä»£å™¨åˆ‡ç‰‡</h3><div class="note note-primary">            <p>ä½¿ç”¨<code>itertools</code>çš„<code>islice()</code>æ–¹æ³•å³å¯</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> islice<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen</span>():<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>        <span class="hljs-keyword">yield</span> i<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> islice(gen(),<span class="hljs-number">10</span>,<span class="hljs-number">20</span>):<br>    <span class="hljs-built_in">print</span>(i) <span class="hljs-comment"># 10....19</span><br><br><span class="hljs-comment"># ä½†æ˜¯æ³¨æ„ï¼Œisliceä¼šæ¶ˆè€—æ‰è¿­ä»£å™¨ï¼Œæ‰€ä»¥æ²¡æ³•å€’å›å»è®¿é—®æ•°æ®</span><br><br></code></pre></td></tr></table></figure><h3 id="ä»¥ç´¢å¼•-å€¼çš„å½¢å¼è¿­ä»£åºåˆ—">ä»¥ç´¢å¼•-å€¼çš„å½¢å¼è¿­ä»£åºåˆ—</h3><div class="note note-primary">            <p>ä½¿ç”¨<code>enumerate()</code>å³å¯</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>a = [<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>]<br><br><span class="hljs-keyword">for</span> index, word <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(a):<br>    <span class="hljs-built_in">print</span>(index,word) <span class="hljs-comment"># 0 a  1 b  2 c</span><br><br></code></pre></td></tr></table></figure><h3 id="åŒæ—¶è¿­ä»£å¤šä¸ªåºåˆ—">åŒæ—¶è¿­ä»£å¤šä¸ªåºåˆ—</h3><div class="note note-primary">            <p>ä½¿ç”¨<code>zip()</code>å‡½æ•°å³å¯ï¼Œå…¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œé•¿åº¦æ˜¯å‚æ•°ä¸­è¾ƒçŸ­çš„ä¸€ä¸ª</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>a = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]<br>b = [<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>]<br><br><span class="hljs-keyword">for</span> x,y <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(a,b):<br>    <span class="hljs-built_in">print</span>(x,y) <span class="hljs-comment"># 1 4  2 5  3 6</span><br><br></code></pre></td></tr></table></figure><h3 id="åœ¨å¤šä¸ªå®¹å™¨ä¸­è¿›è¡Œè¿­ä»£">åœ¨å¤šä¸ªå®¹å™¨ä¸­è¿›è¡Œè¿­ä»£</h3><div class="note note-primary">            <p>ä½¿ç”¨<code>itertools</code>çš„<code>chain()</code>å‡½æ•°å³å¯ï¼Œå¯ä»¥é€ä¸ªè¿­ä»£å¤šä¸ªå®¹å™¨</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> chain<br><br>a = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]<br>b = [<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> chain(a,b):<br>    <span class="hljs-built_in">print</span>(i) <span class="hljs-comment"># 1 2 3 4 5 6 7</span><br><br><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨è¿­ä»£å™¨å–ä»£whileå¾ªç¯">ä½¿ç”¨è¿­ä»£å™¨å–ä»£whileå¾ªç¯</h3><div class="note note-primary">            <p><code>iter(func,sentinal)</code>å¯ä»¥ä¸€ç›´è°ƒç”¨æ— å‚å‡½æ•°funcç›´åˆ°å…¶è¿”å›å“¨å…µå€¼sentinalä¸ºæ­¢</p><p>è¿™æ ·å°±å¯ä»¥å°†whileå¾ªç¯è½¬æ¢æˆè¿­ä»£å™¨æ¨¡å¼</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>times = <span class="hljs-number">1</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen</span>():<br>    <span class="hljs-keyword">global</span> times<br>    <span class="hljs-keyword">if</span> times==<span class="hljs-number">10</span>:<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>    times +=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">iter</span>(gen,-<span class="hljs-number">1</span>):<br>    <span class="hljs-built_in">print</span>(i)<br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonæŠ€å·§</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>PythonCookbook</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonå¥‡æŠ€æ·«å·§(3)</title>
    <link href="/2022/08/30/Python%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7-3/"/>
    <url>/2022/08/30/Python%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7-3/</url>
    
    <content type="html"><![CDATA[<h2 id="å¤„ç†æ•°å­—æ—¶é—´å’Œæ—¥æœŸ----æ¥æºäºcookbookç¬¬ä¸‰ç« ">å¤„ç†æ•°å­—ã€æ—¶é—´å’Œæ—¥æœŸ----æ¥æºäºcookbookç¬¬ä¸‰ç« </h2><span id="more"></span><p><font color="#a0a0dd">è®°å½•ç¬¬ä¸‰ç« ä¸­æ¯”è¾ƒæœ‰æ„æ€çš„éƒ¨åˆ†</font></p><hr><h3 id="ç²¾ç¡®çš„å°æ•°è®¡ç®—">ç²¾ç¡®çš„å°æ•°è®¡ç®—</h3><div class="note note-primary">            <p>ä½¿ç”¨<code>decimal</code>ä¸­çš„<code>Decimal</code>ç±»å°±å¯ä»¥å®ç°ç²¾ç¡®å°æ•°è®¡ç®—ï¼Œè€Œé¿å…å¼•å…¥æµ®ç‚¹æ•°è¯¯å·®ã€‚</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> decimal <span class="hljs-keyword">import</span> Decimal<br><br><span class="hljs-comment"># ä¼ ç»Ÿæµ®ç‚¹æ•°ä¼šå¼•å…¥è¯¯å·®</span><br>a = <span class="hljs-number">4.2</span><br>b = <span class="hljs-number">2.1</span><br><span class="hljs-built_in">print</span>(a + b) <span class="hljs-comment"># 6.300000000000001</span><br><span class="hljs-built_in">print</span>(a + b == <span class="hljs-number">6.3</span>) <span class="hljs-comment"># False</span><br><br><span class="hljs-comment"># ä½¿ç”¨Decimal</span><br>a = Decimal(<span class="hljs-string">'4.2'</span>)<br>b = Decimal(<span class="hljs-string">'2.1'</span>)<br><span class="hljs-built_in">print</span>(a + b) <span class="hljs-comment"># 6.3</span><br><span class="hljs-built_in">print</span>(a + b == Decimal(<span class="hljs-string">'6.3'</span>)) <span class="hljs-comment"># True</span><br><br></code></pre></td></tr></table></figure><h3 id="ç²¾ç¡®çš„åˆ†æ•°è®¡ç®—">ç²¾ç¡®çš„åˆ†æ•°è®¡ç®—</h3><div class="note note-primary">            <p>ä½¿ç”¨<code>fractions</code>ä¸­çš„<code>Fraction</code>å¯ä»¥ç²¾ç¡®çš„è®¡ç®—åˆ†æ•°</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> fractions <span class="hljs-keyword">import</span> Fraction<br><br>a = Fraction(<span class="hljs-number">5</span>,<span class="hljs-number">4</span>)<br>b = Fraction(<span class="hljs-number">7</span>,<span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span>(a + b) <span class="hljs-comment"># 27/16</span><br><br></code></pre></td></tr></table></figure><h3 id="numpyçš„matrixä¸arrayåœ¨å¤„ç†çŸ©é˜µä¸Šçš„å¾®å¦™åŒºåˆ«">numpyçš„matrixä¸arrayåœ¨å¤„ç†çŸ©é˜µä¸Šçš„å¾®å¦™åŒºåˆ«</h3><div class="note note-primary">            <p><code>matrix</code>æ˜¯çŸ©é˜µï¼Œè€Œ<code>array</code>ä¸»è¦æ˜¯æ•°ç»„ï¼Œä¸¤è€…åœ¨è¿ç®—ä¸Šå­˜åœ¨ä¸€äº›åŒºåˆ«</p><ul><li><p>é¦–å…ˆarrayçš„<code>*</code>ï¼Œ<code>**</code>éƒ½æ˜¯ç‚¹ä¹˜ï¼Œå…¶çŸ©é˜µä¹˜æ³•éœ€è¦ä½¿ç”¨<code>np.dot()</code></p></li><li><p>è€Œmatrixçš„<code>*</code>ï¼Œ<code>**</code>éƒ½æ˜¯çŸ©é˜µä¹˜æ³•ï¼Œå…¶ç‚¹ä¹˜éœ€è¦ç”¨åˆ°<code>np.multiply()</code></p></li><li><p>matrixæ±‚é€†å¯ä»¥ç›´æ¥<code>.I</code>ï¼Œè€Œarrayæ±‚é€†éœ€è¦ä½¿ç”¨<code>np.linalg.inv()</code></p></li></ul>          </div>]]></content>
    
    
    <categories>
      
      <category>pythonæŠ€å·§</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>PythonCookbook</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonå¥‡æŠ€æ·«å·§(2)</title>
    <link href="/2022/08/30/Python%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7-2/"/>
    <url>/2022/08/30/Python%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7-2/</url>
    
    <content type="html"><![CDATA[<h2 id="å­—ç¬¦ä¸²ä¸æ–‡æœ¬----æ¥æºäºcookbookç¬¬äºŒç« ">å­—ç¬¦ä¸²ä¸æ–‡æœ¬----æ¥æºäºcookbookç¬¬äºŒç« </h2><span id="more"></span><p><font color="#a0dda0">è®°å½•ç¬¬äºŒç« ä¸­æ¯”è¾ƒæœ‰æ„æ€çš„éƒ¨åˆ†</font></p><hr><div class="note note-info">            <p>å…¶å®è¿™ä¸€ç« è®²çš„æ–¹æ³•æŒºå¤šæŒºæ‚çš„ï¼Œä½†æ˜¯æ—¥å¸¸ä½¿ç”¨åŸºæœ¬å°±æ­£åˆ™å’Œpythonè‡ªå¸¦çš„å­—ç¬¦ä¸²æ–¹æ³•ï¼Œå…¶ä»–çš„æ„Ÿè§‰ç”¨ä¸åˆ°çš„æ ·å­ã€‚</p><p>æ­£åˆ™çš„è¯å¹³æ—¶å†™å¤šäº†è‡ªç„¶å°±ä¼šäº†ï¼Œè¿™é‡Œå°±ä¸è®°å½•äº†</p>          </div><h3 id="å­—ç¬¦ä¸²å¼€å¤´ç»“å°¾æ–‡æœ¬åŒ¹é…">å­—ç¬¦ä¸²å¼€å¤´ç»“å°¾æ–‡æœ¬åŒ¹é…</h3><div class="note note-primary">            <p>ä½¿ç”¨<code>str.startswith()</code>å’Œ<code>str.endwith()</code>å³å¯ã€‚åœ¨å†™æ–‡ä»¶æ‰¹å¤„ç†è„šæœ¬çš„æ—¶å€™ç”¨å¾—åˆ°ã€‚</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>files = [<span class="hljs-string">'a.h'</span>,<span class="hljs-string">'a.c'</span>,<span class="hljs-string">'a.exe'</span>]<br>selected = [file <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files <span class="hljs-keyword">if</span> file.endswith((<span class="hljs-string">".h"</span>,<span class="hljs-string">".c"</span>))]<br><span class="hljs-built_in">print</span>(selected) <span class="hljs-comment"># ['a.h', 'a.c']</span><br><br></code></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²å»é™¤é¦–å°¾ä¸éœ€è¦çš„å­—ç¬¦">å­—ç¬¦ä¸²å»é™¤é¦–å°¾ä¸éœ€è¦çš„å­—ç¬¦</h3><div class="note note-primary">            <p>ä½¿ç”¨<code>str.lstrip()</code>å’Œ<code>str.rstrip()</code>å³å¯</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>s = <span class="hljs-string">'-=-=hellp-=-world-=-=-='</span><br>s = s.lstrip(<span class="hljs-string">"-="</span>)<br><span class="hljs-built_in">print</span>(s) <span class="hljs-comment"># 'hellp-=-world-=-=-='</span><br>s = s.rstrip(<span class="hljs-string">"-="</span>)<br><span class="hljs-built_in">print</span>(s) <span class="hljs-comment"># 'hellp-=-world'</span><br><br></code></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²æ‹¼æ¥">å­—ç¬¦ä¸²æ‹¼æ¥</h3><div class="note note-primary">            <p><code>+</code>ï¼šæ•ˆç‡æœ€ä½ï¼Œä½†æ˜¯ç®€å•</p><p><code>join</code>ï¼šæ•ˆç‡é«˜ï¼Œæ”¯æŒåˆ—è¡¨ç­‰</p><p><code>print(*args,sep=",")</code>ï¼šå®¹æ˜“è¢«é—å¿˜çš„ä¸€ç§æ–¹æ³•</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>a = <span class="hljs-number">1</span><br>b = <span class="hljs-number">2</span><br>c = <span class="hljs-number">3</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">','</span>.join(<span class="hljs-built_in">str</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [a,b,c])) <span class="hljs-comment"># 1,2,3</span><br><span class="hljs-built_in">print</span>(a,b,c,sep=<span class="hljs-string">","</span>) <span class="hljs-comment"># 1,2,3</span><br><br></code></pre></td></tr></table></figure><h3 id="ç»™å­—ç¬¦ä¸²ä¸­å˜é‡ååšæ’å€¼">ç»™å­—ç¬¦ä¸²ä¸­å˜é‡ååšæ’å€¼</h3><div class="note note-primary">            <p>ä½œè€…åœ¨ä¹¦ä¸­æåˆ°pythonæ²¡æ³•ç›´æ¥å¤„ç†å­—ç¬¦ä¸²æ’å€¼ï¼Œå¹¶å®ç°äº†ä¸€äº›å¤æ‚çš„æ–¹æ³•ï¼Œ<br>å¹¸è¿çš„æ˜¯ï¼Œæ–°ç‰ˆæœ¬çš„pythonå·²ç»ç›´æ¥æ”¯æŒæ’å€¼äº†ï¼Œä¸éœ€æ‰‹åŠ¨å»å®ç°äº†</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>name = <span class="hljs-string">'book'</span><br>price = <span class="hljs-number">10</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{name}</span>' price is <span class="hljs-subst">{price}</span>"</span>) <span class="hljs-comment"># book' price is 10</span><br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonæŠ€å·§</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>PythonCookbook</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonå¥‡æŠ€æ·«å·§(1)</title>
    <link href="/2022/08/30/Python%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7-1/"/>
    <url>/2022/08/30/Python%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7-1/</url>
    
    <content type="html"><![CDATA[<h2 id="åŸºæœ¬æ•°æ®ç»“æ„ä¸ç®—æ³•----æ¥æºäºcookbookç¬¬ä¸€ç« ">åŸºæœ¬æ•°æ®ç»“æ„ä¸ç®—æ³•----æ¥æºäºcookbookç¬¬ä¸€ç« </h2><span id="more"></span><p><font color="#dda0a0">è®°å½•ç¬¬ä¸€ç« ä¸­æ¯”è¾ƒæœ‰æ„æ€çš„éƒ¨åˆ†</font></p><hr><h3 id="å…ƒç´ åˆ†è§£">å…ƒç´ åˆ†è§£</h3><div class="note note-primary">            <p>é€šè¿‡<code>*è¡¨è¾¾å¼</code>æ¥è§£åŒ…è£¹å®ç°åˆ†è§£</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">l = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,(<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>)]<br><br>first, *_, (*__, last) = l<br><br><span class="hljs-built_in">print</span>(first,last) <span class="hljs-comment"># 1 7</span><br><br></code></pre></td></tr></table></figure><h3 id="å°†å­—å…¸çš„é”®æ˜ å°„åˆ°å¤šä¸ªå€¼ä¸Š">å°†å­—å…¸çš„é”®æ˜ å°„åˆ°å¤šä¸ªå€¼ä¸Š</h3><div class="note note-primary">            <ul><li><p>é€šè¿‡ä½¿ç”¨<code>collections</code>ä¸­çš„<code>defaultdict</code>æ¥å®ç°ä¸€é”®å¤šå€¼å­—å…¸</p></li><li><p>é€šè¿‡<code>dict</code>ç±»çš„<code>setdefault</code>æ–¹æ³•æ¥å®ç°</p></li></ul>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ–¹æ³•ä¸€</span><br><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><br>d = defaultdict(<span class="hljs-built_in">list</span>) <span class="hljs-comment"># æˆ–defaultdict(set)</span><br>d[<span class="hljs-string">'a'</span>].append(<span class="hljs-number">1</span>)<br>d[<span class="hljs-string">'a'</span>].append(<span class="hljs-number">2</span>)<br>d[<span class="hljs-string">'b'</span>].append(<span class="hljs-number">3</span>)<br><span class="hljs-built_in">print</span>(d) <span class="hljs-comment"># {'a': [1, 2], 'b': [3]}</span><br><br><br><span class="hljs-comment"># æ–¹æ³•äºŒ</span><br><br>d = {}<br>d.setdefault(<span class="hljs-string">'a'</span>,[]).append(<span class="hljs-number">1</span>)<br>d.setdefault(<span class="hljs-string">'a'</span>,[]).append(<span class="hljs-number">2</span>)<br>d.setdefault(<span class="hljs-string">'b'</span>,[]).append(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(d) <span class="hljs-comment"># {'a': [1, 2], 'b': [3]}</span><br><br></code></pre></td></tr></table></figure><h3 id="ä¸¤ä¸ªå­—å…¸çš„é›†åˆè¿ç®—">ä¸¤ä¸ªå­—å…¸çš„é›†åˆè¿ç®—</h3><div class="note note-primary">            <p>å­—å…¸æ”¯æŒé›†åˆè¿ç®—ç¬¦ï¼Œå¯ä»¥å¯¹å…¶æ±‚äº¤é›†ã€å¹¶é›†ç­‰</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>a = {<br>    <span class="hljs-string">'x'</span> : <span class="hljs-number">1</span>,<br>    <span class="hljs-string">'y'</span> : <span class="hljs-number">2</span>,<br>    <span class="hljs-string">'z'</span> : <span class="hljs-number">3</span><br>}<br><br>b={<br>    <span class="hljs-string">'x'</span> : <span class="hljs-number">10</span>,<br>    <span class="hljs-string">'w'</span> : <span class="hljs-number">11</span>,<br>    <span class="hljs-string">'z'</span> : <span class="hljs-number">3</span><br>}<br><br><span class="hljs-built_in">print</span>(a.keys() &amp; b.keys()) <span class="hljs-comment"># {'z', 'x'}</span><br><span class="hljs-built_in">print</span>(a.keys() - b.keys()) <span class="hljs-comment"># {'y'}</span><br><span class="hljs-built_in">print</span>(a.items() &amp; b.items()) <span class="hljs-comment"># {('z', 3)}</span><br><br></code></pre></td></tr></table></figure><h3 id="å­—å…¸æ¨å¯¼å¼">å­—å…¸æ¨å¯¼å¼</h3><div class="note note-primary">            <p>æ„Ÿè§‰å­—å…¸æ¨å¯¼å¼ä¸å¦‚ç”Ÿæˆå™¨æ¨å¯¼å¼å’Œåˆ—è¡¨æ¨å¯¼å¼ç”¨çš„å¤š</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>prices = {<br>    <span class="hljs-string">'a'</span> : <span class="hljs-number">45</span>,<br>    <span class="hljs-string">'b'</span> : <span class="hljs-number">32</span>,<br>    <span class="hljs-string">'c'</span> : <span class="hljs-number">10</span><br>}<br><br>p1 = {key:value <span class="hljs-keyword">for</span> key,value <span class="hljs-keyword">in</span> prices.items() <span class="hljs-keyword">if</span> value &gt;<span class="hljs-number">20</span>}<br><span class="hljs-built_in">print</span>(p1) <span class="hljs-comment"># {'a': 45, 'b': 32}</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>pythonæŠ€å·§</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>PythonCookbook</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>levelDBæºç å‰–æ(4)</title>
    <link href="/2022/08/30/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-4/"/>
    <url>/2022/08/30/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-4/</url>
    
    <content type="html"><![CDATA[<h2 id="leveldbçš„ç¼–ç æ ¼å¼">levelDBçš„ç¼–ç æ ¼å¼</h2><span id="more"></span><hr><h3 id="å­˜å‚¨æ–¹å¼">å­˜å‚¨æ–¹å¼</h3><p>å½“æ•°æ®åº“è·å–åˆ°å†…å­˜åï¼Œå…¶éœ€è¦å°†æ•°æ®æ’å…¥åˆ°å†…å­˜ä¸­ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶å€™è¯»å–å‡ºæ¥ï¼Œå¦‚ä½•é«˜æ•ˆåœ°åˆ©ç”¨ç”³è¯·åˆ°çš„å†…å­˜å°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„é—®é¢˜ã€‚</p><div class="note note-info">            <p>åœ¨levelDBä¸­ï¼Œæ•°æ®æ˜¯æŒ‰ç…§ä¸‹åˆ—æ–¹æ³•å­˜å‚¨çš„ï¼š</p><ul><li><p>æ•´æ•°åˆ†ä¸º32ä½å’Œ64ä½å®šé•¿æ•´æ•°</p></li><li><p>æ•´æ•°è¿˜ä½¿ç”¨å˜é•¿æ•´æ•°å­˜å‚¨</p></li><li><p>æ•´æ•°å‡ä¸ºå°ç«¯æ³•å­˜å‚¨</p></li><li><p>å­—ç¬¦ä¸²é‡‡ç”¨é•¿åº¦å‰ç¼€ç¼–ç </p></li></ul>          </div><h4 id="å˜é•¿æ•´æ•°ä¸å®šé•¿æ•´æ•°">å˜é•¿æ•´æ•°ä¸å®šé•¿æ•´æ•°</h4><p>æ‰€è°“å®šé•¿æ•´æ•°å°±æ˜¯æˆ‘ä»¬å¹³æ—¶åœ¨Cè¯­è¨€ä¸­å®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œå…¶é•¿åº¦æ˜¯å§‹ç»ˆä¸å˜çš„ã€‚</p><p>è€Œå˜é•¿æ•´æ•°åˆ™é¡¾åæ€ä¹‰ï¼Œå…¶ç¼–ç çš„åŸç†æ˜¯åªä½¿ç”¨ä¸€ä¸ªå­—èŠ‚çš„ä½7ä½å»å­˜å‚¨æ•°æ®ï¼Œè€Œæœ€é«˜ä½çš„ç”¨äºåšæ ‡è¯†ï¼šå½“æœ€é«˜ä½ä¸º1æ—¶è¡¨ç¤ºéœ€è¦ç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªå­—èŠ‚ã€‚</p><img src="/2022/08/30/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-4/pic1.jpg" class="" title="_"><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™æ ·å˜é•¿æ•´æ•°å°±å¯ä»¥ä½¿ç”¨1-5å­—èŠ‚å»è¡¨ç¤ºint32çš„æ‰€æœ‰æ•´æ•°ï¼Œè¡¨é¢ä¸Šçœ‹ï¼Œè™½ç„¶è¡¨ç¤ºéå¸¸å¤§çš„æ•´æ•°çš„æ—¶å€™å˜é•¿æ•´æ•°ç¼–ç ä¼šå ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œä½†æ˜¯ç”±äºå¤§æ•´æ•°å‡ºç°çš„é¢‘ç‡ä¸€èˆ¬æ˜¯æ¯”è¾ƒå°çš„ï¼Œæ‰€ä»¥å°±æ™®éè€Œè¨€ï¼Œä½¿ç”¨å˜é•¿æ•´æ•°ä¼šèŠ‚çœæ›´å¤šçš„å†…å­˜ã€‚</p><h4 id="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²</h4><p>å­—ç¬¦ä¸²ä½¿ç”¨é•¿åº¦å‰ç¼€ç¼–ç ï¼Œå³åœ¨æŠŠå­—ç¬¦ä¸²çš„é•¿åº¦æ”¾åœ¨å­—ç¬¦ä¸²çš„å‰é¢ï¼Œç„¶åç»„åˆèµ·æ¥ç¼–ç ã€‚</p><p>è€ŒåŒæ—¶ï¼Œå­—ç¬¦ä¸²é•¿åº¦ä½¿ç”¨å˜é•¿æ•´æ•°è¿›è¡Œç¼–ç ï¼Œæ‰€ä»¥ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­˜å‚¨æ ¼å¼æ˜¯<code>32ä½å˜é•¿æ•´æ•°ç¼–ç å­—ç¬¦ä¸²é•¿åº¦ + å­—ç¬¦ä¸²æœ¬èº«</code></p><p>ä½¿ç”¨é•¿åº¦å‰ç¼€ç¼–ç çš„æ–¹å¼ï¼Œå­—ç¬¦ä¸²èƒ½å¤Ÿç¼–ç ä»»æ„å­—ç¬¦(æ¯”å¦‚Cè¯­è¨€ä¸èƒ½åœ¨å­—ç¬¦ä¸²ä¸­åŒ…å«'\0')ï¼ŒåŒæ—¶ï¼Œå­—ç¬¦ä¸²çš„é•¿åº¦å¯ä»¥é¢„å…ˆçŸ¥é“ï¼Œæ‰€ä»¥æœ‰åˆ©äºè¯»å†™æ“ä½œã€‚å¦å¤–ï¼Œå¯¹äºå¤§éƒ¨åˆ†å­—ç¬¦ä¸²çš„é•¿åº¦éƒ½æ¯”è¾ƒçŸ­çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šé€ æˆå¤§é‡å†…å­˜æŸå¤±ã€‚</p><h3 id="æºç è§£æéƒ¨åˆ†">æºç è§£æéƒ¨åˆ†</h3><div class="note note-primary">            <p>æºç ä½ç½®ï¼š <code>utils/coding.cc</code><code>utils/coding.h</code></p>          </div><h4 id="å¤´æ–‡ä»¶">å¤´æ–‡ä»¶</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ç¼–ç è§£ç å’Œæ’å…¥æ•°æ®çš„å¤´æ–‡ä»¶ï¼Œè¿™éƒ¨åˆ†å†…å®¹å¾ˆç®€å•ï¼Œå°±æ˜¯å¤„ç†ç¼–ç æ ¼å¼çš„ä¸€äº›æ–¹æ³•ã€‚</p><p>å…¶ä¸­è¦æ³¨æ„ç”¨åˆ°äº†ä¸€ä¸ªç±»<code>Slice</code>ï¼Œè¿™ä¸ªç±»æ˜¯å¯¹å­—ç¬¦ä¸²çš„å°è£…ï¼Œæ¯”<code>std::string</code>å°è£…æ›´åŠ ä½çº§ï¼Œæ‰€ä»¥æ•ˆç‡ä¼šæ›´é«˜ï¼Œåé¢çš„æ–‡ç« ä¼šç»†ğŸ”’å®ƒã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PutFixed32</span><span class="hljs-params">(std::string *dst, <span class="hljs-type">uint32_t</span> value)</span></span>;                 <span class="hljs-comment">// æ’å…¥å®šé•¿32ä½æ•´æ•°</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PutFixed64</span><span class="hljs-params">(std::string *dst, <span class="hljs-type">uint64_t</span> value)</span></span>;                 <span class="hljs-comment">//æ’å…¥å®šé•¿64ä½æ•´æ•°</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PutVarint32</span><span class="hljs-params">(std::string *dst, <span class="hljs-type">uint32_t</span> value)</span></span>;                <span class="hljs-comment">//æ’å…¥å˜é•¿32ä½æ•´æ•°</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PutVarint64</span><span class="hljs-params">(std::string *dst, <span class="hljs-type">uint64_t</span> value)</span></span>;                <span class="hljs-comment">//æ’å…¥å˜é•¿64ä½æ•´æ•°</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PutLengthPrefixedSlice</span><span class="hljs-params">(std::string *dst, <span class="hljs-type">const</span> Slice &amp;value)</span></span>; <span class="hljs-comment">//æ’å…¥å­—ç¬¦ä¸²</span><br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">GetVarint32</span><span class="hljs-params">(Slice *input, <span class="hljs-type">uint32_t</span> *value)</span></span>;          <span class="hljs-comment">// è·å–å˜é•¿32ä½æ•´æ•°</span><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">GetVarint64</span><span class="hljs-params">(Slice *input, <span class="hljs-type">uint64_t</span> *value)</span></span>;          <span class="hljs-comment">// è·å–å˜é•¿64ä½æ•´æ•°</span><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">GetLengthPrefixedSlice</span><span class="hljs-params">(Slice *input, Slice *result)</span></span>; <span class="hljs-comment">// è·å–å­—ç¬¦ä¸²</span><br><br><span class="hljs-comment">// ç”¨äºè§£ç 32/64ä½å˜é•¿æ•´æ•°çš„å‡½æ•°ï¼Œå…¶ä¸­pæ˜¯æŒ‡å‘å˜é•¿æ•´æ•°ï¼Œlimitæ˜¯å˜é•¿æ•´æ•°æœ€å¤§é•¿åº¦</span><br><span class="hljs-comment">// è€Œvå­˜æ”¾çš„æ˜¯è§£ç åçš„å€¼ï¼Œå¦‚æœä¸èƒ½è§£ç åˆ™è¿”å›null</span><br><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-title">GetVarint32Ptr</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *p, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *limit, <span class="hljs-type">uint32_t</span> *v)</span></span>;<br><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-title">GetVarint64Ptr</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *p, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *limit, <span class="hljs-type">uint64_t</span> *v)</span></span>;<br><br><span class="hljs-comment">// è¿™æ˜¯ä¸Šé¢GetVarint32Ptrå‡½æ•°çš„å†…éƒ¨å›è°ƒå‡½æ•°ï¼Œæ˜¯å®é™…å¤„ç†å˜é•¿æ•´æ•°çš„ä¸œè¥¿</span><br><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-title">GetVarint32PtrFallback</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *p, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *limit,</span></span><br><span class="hljs-params"><span class="hljs-function">                                   <span class="hljs-type">uint32_t</span> *value)</span></span>;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">VarintLength</span><span class="hljs-params">(<span class="hljs-type">uint64_t</span> v)</span></span>; <span class="hljs-comment">// è¿”å›å˜é•¿æ•´æ•°(32/64)çš„'é•¿åº¦'</span><br><br><span class="hljs-function"><span class="hljs-type">char</span> *<span class="hljs-title">EncodeVarint32</span><span class="hljs-params">(<span class="hljs-type">char</span> *dst, <span class="hljs-type">uint32_t</span> value)</span></span>; <span class="hljs-comment">// ç¼–ç å˜é•¿32ä½æ•´æ•°</span><br><span class="hljs-function"><span class="hljs-type">char</span> *<span class="hljs-title">EncodeVarint64</span><span class="hljs-params">(<span class="hljs-type">char</span> *dst, <span class="hljs-type">uint64_t</span> value)</span></span>; <span class="hljs-comment">// ç¼–ç å˜é•¿64ä½æ•´æ•°</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">EncodeFixed32</span><span class="hljs-params">(<span class="hljs-type">char</span> *dst, <span class="hljs-type">uint32_t</span> value)</span></span>; <span class="hljs-comment">// ç¼–ç å®šé•¿32ä½æ•´æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">EncodeFixed64</span><span class="hljs-params">(<span class="hljs-type">char</span> *dst, <span class="hljs-type">uint64_t</span> value)</span></span>; <span class="hljs-comment">// ç¼–ç å®šé•¿64ä½æ•´æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">uint32_t</span> <span class="hljs-title">DecodeFixed32</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *ptr)</span></span>;       <span class="hljs-comment">// è§£ç 32ä½å®šé•¿æ•´æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">uint64_t</span> <span class="hljs-title">DecodeFixed64</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *ptr)</span></span>;       <span class="hljs-comment">// è§£ç 64ä½å®šé•¿æ•´æ•°</span><br><br></code></pre></td></tr></table></figure><p>å¤´æ–‡ä»¶åªæ˜¯ç»™å‡ºäº†å‡½æ•°æ¥å£ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥è¿›ä¸€æ­¥å»åˆ†æå„ä¸ªå‡½æ•°ã€‚</p><h4 id="å®ç°æ–‡ä»¶">å®ç°æ–‡ä»¶</h4><p>ä¸ºäº†æ–¹ä¾¿åˆ†æï¼Œæˆ‘ä»¬å°†å…¶åˆ†æˆï¼šç¼–ç è§£ç å®šé•¿æ•´æ•°ã€ç¼–ç è§£ç å˜é•¿æ•´æ•°ã€Putå’ŒGetæ–¹æ³•ã€‚</p><p>è¿™éƒ¨åˆ†ä»£ç å…¨éƒ¨å›´ç»•ç¼–ç è§£ç æ¥å®ç°çš„ï¼Œå…¶ä¸­å®šé•¿çš„ç¼–è§£ç å¾ˆç®€å•ï¼Œå°±ä¸åœ¨æ­¤èµ˜è¿°äº†ã€‚å…³äºå˜é•¿æ•´æ•°çš„ç¼–è§£ç ï¼Œå…¶å…³äºç¼–ç å’Œè§£ç çš„ç›¸å…³å‡½æ•°éƒ½é¢„ç•™äº†ç±»ä¼¼è¿­ä»£å™¨ä¸€æ ·çš„è¶…å°¾å…ƒç´ (æŒ‡é’ˆ)ï¼Œè¿™ç§å½¢å¼çš„æ¥å£å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç¡®å®šæ‰€å¤„ç†æ•°æ®çš„åŒºé—´(å˜é•¿æ•´æ•°çš„Putå’ŒGetç›¸å…³å‡½æ•°éƒ½ä½¿ç”¨åˆ°äº†é¢„ç•™çš„è¶…å°¾å…ƒç´ )ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><br><br><span class="hljs-comment">// å†…è”å‡½æ•°æœ¬æ¥æ˜¯åœ¨å¤´æ–‡ä»¶ä¸­çš„ï¼Œä½†æ˜¯æ­¤å¤„å°†å…¶å½“æˆä¸€ä¸ªå‡½æ•°æ¥è¿›è¡Œåˆ†æ</span><br><br><span class="hljs-comment">/*=============ç¼–ç è§£ç å®šé•¿æ•´æ•°=============*/</span><br><br><span class="hljs-comment">// ç¼–ç å®šé•¿32ä½æ•´æ•°ï¼Œå®ç°æ€è·¯å°±æ˜¯ç±»ä¼¼ç»“æ„ä½“é‚£æ ·å»åˆ†å‰²uint32å³å¯</span><br><span class="hljs-comment">// ä½†æ³¨æ„ä¿è¯è®©dstæœ‰è¶³å¤Ÿçš„ç©ºé—´å»å­˜å‚¨ï¼Œå¦åˆ™ä¼šæº¢å‡ºæˆ–æ®µé”™è¯¯</span><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">EncodeFixed32</span><span class="hljs-params">(<span class="hljs-type">char</span> *dst, <span class="hljs-type">uint32_t</span> value)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// reinterpret_castå…è®¸æŒ‡é’ˆ(å¼•ç”¨)ä¹‹é—´è½¬æ¢</span><br>    <span class="hljs-comment">// æ•´å‹ä¸æŒ‡é’ˆç±»å‹é—´çš„è½¬æ¢ä»¥åŠæŒ‡é’ˆä¸è¶³å¤Ÿå¤§çš„æ•´å‹ä¹‹é—´çš„è½¬æ¢</span><br>    <span class="hljs-type">uint8_t</span> *<span class="hljs-type">const</span> buffer = <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">uint8_t</span> *&gt;(dst);<br><br>    buffer[<span class="hljs-number">0</span>] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(value);<br>    buffer[<span class="hljs-number">1</span>] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(value &gt;&gt; <span class="hljs-number">8</span>);<br>    buffer[<span class="hljs-number">2</span>] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(value &gt;&gt; <span class="hljs-number">16</span>);<br>    buffer[<span class="hljs-number">3</span>] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(value &gt;&gt; <span class="hljs-number">24</span>);<br>}<br><br><span class="hljs-comment">// ç¼–ç å®šé•¿64ä½æ•´æ•°ï¼Œæ€è·¯ä¸ç¼–ç å®šé•¿32ä½æ•´æ•°ä¸€è‡´</span><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">EncodeFixed64</span><span class="hljs-params">(<span class="hljs-type">char</span> *dst, <span class="hljs-type">uint64_t</span> value)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-type">uint8_t</span> *<span class="hljs-type">const</span> buffer = <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">uint8_t</span> *&gt;(dst);<br><br>    buffer[<span class="hljs-number">0</span>] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(value);<br>    buffer[<span class="hljs-number">1</span>] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(value &gt;&gt; <span class="hljs-number">8</span>);<br>    buffer[<span class="hljs-number">2</span>] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(value &gt;&gt; <span class="hljs-number">16</span>);<br>    buffer[<span class="hljs-number">3</span>] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(value &gt;&gt; <span class="hljs-number">24</span>);<br>    buffer[<span class="hljs-number">4</span>] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(value &gt;&gt; <span class="hljs-number">32</span>);<br>    buffer[<span class="hljs-number">5</span>] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(value &gt;&gt; <span class="hljs-number">40</span>);<br>    buffer[<span class="hljs-number">6</span>] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(value &gt;&gt; <span class="hljs-number">48</span>);<br>    buffer[<span class="hljs-number">7</span>] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(value &gt;&gt; <span class="hljs-number">56</span>);<br>}<br><br><span class="hljs-comment">// è§£ç 32ä½å®šé•¿æ•´æ•°å¹¶è¿”å›ï¼Œè¿™åŒæ ·ä¸åšè¾¹ç•Œæ£€æŸ¥</span><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">uint32_t</span> <span class="hljs-title">DecodeFixed32</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *ptr)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> *<span class="hljs-type">const</span> buffer = <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> *&gt;(ptr);<br><br>    <span class="hljs-comment">// æ³¨æ„æ˜¯å°ç«¯å­˜å‚¨ç»“æ„</span><br>    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint32_t</span>&gt;(buffer[<span class="hljs-number">0</span>])) |<br>           (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint32_t</span>&gt;(buffer[<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">8</span>) |<br>           (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint32_t</span>&gt;(buffer[<span class="hljs-number">2</span>]) &lt;&lt; <span class="hljs-number">16</span>) |<br>           (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint32_t</span>&gt;(buffer[<span class="hljs-number">3</span>]) &lt;&lt; <span class="hljs-number">24</span>);<br>}<br><br><span class="hljs-comment">// è§£ç 64ä½å®šé•¿æ•´æ•°å¹¶è¿”å›ï¼Œä¸ä¸Šç±»ä¼¼</span><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">uint64_t</span> <span class="hljs-title">DecodeFixed64</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *ptr)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> *<span class="hljs-type">const</span> buffer = <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> *&gt;(ptr);<br><br>    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint64_t</span>&gt;(buffer[<span class="hljs-number">0</span>])) |<br>           (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint64_t</span>&gt;(buffer[<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">8</span>) |<br>           (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint64_t</span>&gt;(buffer[<span class="hljs-number">2</span>]) &lt;&lt; <span class="hljs-number">16</span>) |<br>           (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint64_t</span>&gt;(buffer[<span class="hljs-number">3</span>]) &lt;&lt; <span class="hljs-number">24</span>) |<br>           (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint64_t</span>&gt;(buffer[<span class="hljs-number">4</span>]) &lt;&lt; <span class="hljs-number">32</span>) |<br>           (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint64_t</span>&gt;(buffer[<span class="hljs-number">5</span>]) &lt;&lt; <span class="hljs-number">40</span>) |<br>           (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint64_t</span>&gt;(buffer[<span class="hljs-number">6</span>]) &lt;&lt; <span class="hljs-number">48</span>) |<br>           (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint64_t</span>&gt;(buffer[<span class="hljs-number">7</span>]) &lt;&lt; <span class="hljs-number">56</span>);<br>}<br><br><span class="hljs-comment">/*=============ç¼–ç è§£ç å˜é•¿æ•´æ•°=============*/</span><br><br><span class="hljs-comment">// ç¼–ç 32ä½å˜é•¿æ•´æ•°</span><br><span class="hljs-function"><span class="hljs-type">char</span> *<span class="hljs-title">EncodeVarint32</span><span class="hljs-params">(<span class="hljs-type">char</span> *dst, <span class="hljs-type">uint32_t</span> v)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// è¿™ä¸€éƒ¨åˆ†çš„ç¼–ç å°±æ˜¯å®Œå…¨æŒ‰ç…§å®šä¹‰æ¥çš„ï¼Œç”¨äº†5ä¸ªif</span><br>    <span class="hljs-comment">// åˆ†åˆ«å¯¹åº”äº†1-5ä¸ªå­—èŠ‚èŒƒå›´å†…çš„é•¿åº¦</span><br>    <span class="hljs-type">uint8_t</span> *ptr = <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">uint8_t</span> *&gt;(dst);<br>    <span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">int</span> B = <span class="hljs-number">128</span>;<br>    <span class="hljs-comment">/* ä»¿ç…§EncodeVarint64çš„å¾ªç¯å†™æ³•æ¥é‡å†™è¿™ä¸€éƒ¨åˆ†</span><br><span class="hljs-comment">    while(v&gt;=B)</span><br><span class="hljs-comment">    {</span><br><span class="hljs-comment">        *(ptr++) = v|B;</span><br><span class="hljs-comment">        v &gt;&gt;= 7;</span><br><span class="hljs-comment">    }</span><br><span class="hljs-comment">    *(ptr++) = static_cast&lt;uint8_t&gt;(v);</span><br><span class="hljs-comment">    return reinterpret_cast&lt;char *&gt;(ptr);</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span> (v &lt; (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">7</span>))<br>    {<br>        *(ptr++) = v;<br>    }<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (v &lt; (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">14</span>))<br>    {<br>        *(ptr++) = v | B;<br>        *(ptr++) = v &gt;&gt; <span class="hljs-number">7</span>;<br>    }<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (v &lt; (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">21</span>))<br>    {<br>        *(ptr++) = v | B;<br>        *(ptr++) = (v &gt;&gt; <span class="hljs-number">7</span>) | B;<br>        *(ptr++) = v &gt;&gt; <span class="hljs-number">14</span>;<br>    }<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (v &lt; (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">28</span>))<br>    {<br>        *(ptr++) = v | B;<br>        *(ptr++) = (v &gt;&gt; <span class="hljs-number">7</span>) | B;<br>        *(ptr++) = (v &gt;&gt; <span class="hljs-number">14</span>) | B;<br>        *(ptr++) = v &gt;&gt; <span class="hljs-number">21</span>;<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>        *(ptr++) = v | B;<br>        *(ptr++) = (v &gt;&gt; <span class="hljs-number">7</span>) | B;<br>        *(ptr++) = (v &gt;&gt; <span class="hljs-number">14</span>) | B;<br>        *(ptr++) = (v &gt;&gt; <span class="hljs-number">21</span>) | B;<br>        *(ptr++) = v &gt;&gt; <span class="hljs-number">28</span>;<br>    }<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">char</span> *&gt;(ptr);<br>}<br><br><span class="hljs-comment">// ç¼–ç 64ä½å˜é•¿æ•´æ•°ï¼Œæ­¤å¤„æ²¡æœ‰ä½¿ç”¨å¾ªç¯ï¼ŒåŒæ ·çš„ï¼Œä¸Šé¢32ä½çš„ä¹Ÿå¯ä»¥è¿™æ ·å†™</span><br><span class="hljs-function"><span class="hljs-type">char</span> *<span class="hljs-title">EncodeVarint64</span><span class="hljs-params">(<span class="hljs-type">char</span> *dst, <span class="hljs-type">uint64_t</span> v)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// å°†å‡½æ•°å†…çš„å¸¸æ•°è®¾ç½®ä¸ºå±€éƒ¨é™æ€å˜é‡ï¼Œå‡å°‘æ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶çš„åˆ†é…ä¸å¼€é”€</span><br>    <span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">int</span> B = <span class="hljs-number">128</span>;<br>    <span class="hljs-type">uint8_t</span> *ptr = <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">uint8_t</span> *&gt;(dst);<br>    <span class="hljs-comment">// Bè¢«è®¾ç½®æˆ1&lt;&lt;7ï¼Œå½“v&gt;=bæ—¶è¡¨ç¤º7ä½å­˜ä¸ä¸‹</span><br>    <span class="hljs-keyword">while</span> (v &gt;= B)<br>    {<br>        *(ptr++) = v | B;<br>        v &gt;&gt;= <span class="hljs-number">7</span>;<br>    }<br>    *(ptr++) = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(v);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">char</span> *&gt;(ptr);<br>}<br><br><span class="hljs-comment">// è§£ç 32ä½å˜é•¿æ•´æ•°ï¼Œè¿™ä¸ªå‡½æ•°åªå¤„ç†å°äº128çš„å•å­—èŠ‚å˜é•¿æ•´æ•°</span><br><span class="hljs-comment">// å¤§äº127çš„éƒ¨åˆ†åˆ™è°ƒç”¨GetVarint32PtrFallbackå¤„ç†</span><br><span class="hljs-comment">// æ­¤å‡½æ•°å°†è§£ç åçš„å€¼æ”¾åœ¨valueä¸­</span><br><span class="hljs-comment">// limitæ€»æ˜¯ä¸ºp+5ï¼Œå› ä¸ºå˜é•¿æ•´æ•°æœ€å¤š5ä¸ªå­—èŠ‚</span><br><span class="hljs-comment">// pæ˜¯ä¸€ä¸ªæŒ‡å‘åŒ…å«å€¼å¾—å­—ç¬¦ä¸²</span><br><span class="hljs-comment">// è¿”å›çš„æ˜¯å¯¹å˜é•¿æ•´æ•°è§£ç åçš„ä¸€ä¸ªå­—èŠ‚ï¼Œè®¾ç½®æˆè¿™æ ·çš„ç›®çš„æ˜¯ç”¨äºgetæ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-title">GetVarint32Ptr</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *p, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *limit,</span></span><br><span class="hljs-params"><span class="hljs-function">                                  <span class="hljs-type">uint32_t</span> *value)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-keyword">if</span> (p &lt; limit)<br>    {<br>        <span class="hljs-type">uint32_t</span> result = *(<span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> *&gt;(p));<br>        <span class="hljs-comment">// å†…éƒ¨åªè§£ç ä¸è¶…è¿‡127çš„æ•´æ•°ï¼Œå‰©ä¸‹çš„æ›´é•¿çš„äº¤ç»™GetVarint32PtrFallbackå¤„ç†</span><br>        <span class="hljs-keyword">if</span> ((result &amp; <span class="hljs-number">128</span>) == <span class="hljs-number">0</span>)<br>        {<br>            *value = result;<br>            <span class="hljs-keyword">return</span> p + <span class="hljs-number">1</span>;<br>        }<br>    }<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">GetVarint32PtrFallback</span>(p, limit, value);<br>}<br><br><span class="hljs-comment">// è§£ç 32ä½å˜é•¿æ•´æ•°ä¸­å¤§äº127çš„æ•°å­—ï¼Œå³å­˜å‚¨è¶…è¿‡1ä¸ªå­—èŠ‚çš„å˜é•¿32ä½æ•´æ•°</span><br><span class="hljs-comment">// è¢«GetVarint32Ptrè°ƒç”¨</span><br><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-title">GetVarint32PtrFallback</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *p, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *limit,</span></span><br><span class="hljs-params"><span class="hljs-function">                                   <span class="hljs-type">uint32_t</span> *value)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-type">uint32_t</span> result = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">// ç”±äº32ä½å˜é•¿æ•´æ•°åªèƒ½ç”±28ä½å­˜å‚¨æ•°å­—ï¼Œæ‰€ä»¥åç§»çš„ä¸Šé™å°±æ˜¯28ä½</span><br>    <span class="hljs-comment">// æ¯ä¸ªå­—èŠ‚åªèƒ½å­˜å‚¨7ä½æœ‰æ•ˆå­—ç¬¦ï¼Œæ‰€ä»¥æ¯å¤„ç†ä¸€å­—èŠ‚å°±åç§»7ä½</span><br>    <span class="hljs-comment">// shiftåŒæ—¶ä¹Ÿæ˜¯æ¯ä¸ªå­—èŠ‚ä¸­æœ‰æ•ˆæ•°å­—çš„æƒ</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> shift = <span class="hljs-number">0</span>; shift &lt;= <span class="hljs-number">28</span> &amp;&amp; p &lt; limit; shift += <span class="hljs-number">7</span>)<br>    {<br>        <span class="hljs-comment">// è§£ç å‡ºä¸€ä¸ªå­—èŠ‚</span><br>        <span class="hljs-type">uint32_t</span> byte = *(<span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> *&gt;(p));<br>        p++;<br>        <span class="hljs-comment">// åˆ¤æ–­æœ€é«˜ä½ï¼Œå¦‚æœæ˜¯1åˆ™ç»§ç»­å–å¹¶æ‰§è¡Œï¼Œå¦åˆ™å°±è¿”å›è§£ç çš„æ•°æ®</span><br>        <span class="hljs-keyword">if</span> (byte &amp; <span class="hljs-number">128</span>)<br>        {<br>            result |= ((byte &amp; <span class="hljs-number">127</span>) &lt;&lt; shift);<br>        }<br>        <span class="hljs-keyword">else</span><br>        {<br>            result |= (byte &lt;&lt; shift);<br>            *value = result;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">const</span> <span class="hljs-type">char</span> *&gt;(p);<br>        }<br>    }<br><br>    <span class="hljs-comment">// å½“å˜é•¿æ•´æ•°ç¼–ç ä¸æ­£ç¡®å°±è¿”å›nullptr</span><br>    <span class="hljs-comment">// ä¸æ­£ç¡®çš„åŸå› åªèƒ½æ˜¯å› ä¸ºè¿ç»­5ä¸ªå­—èŠ‚éƒ½æ˜¯è¢«æ ‡è®°ä¸º1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>}<br><br><span class="hljs-comment">// è§£ç 64ä½å˜é•¿æ•´æ•°çš„å‡½æ•°ï¼Œä¸è§£ç 32ä½å˜é•¿çš„é‚£ä¸ªå‡½æ•°ç±»ä¼¼</span><br><span class="hljs-comment">// ä¸è¿‡è¿™ä¸ªå‡½æ•°æ²¡æœ‰å›è°ƒï¼Œæ˜¯ç›´æ¥åœ¨æœ¬å‡½æ•°å†…è¿›è¡Œå…¨éƒ¨çš„è§£ç å·¥ä½œ</span><br><span class="hljs-comment">// åŸå› æˆ‘è§‰å¾—æ˜¯è¿™æ ·çš„ï¼šå› ä¸ºå°æ•´æ•°æ¯”è¾ƒå¤šï¼Œè€Œå°æ•´æ•°ä¸€èˆ¬å°±ä»¥32ä½å˜é•¿å­˜å‚¨</span><br><span class="hljs-comment">// è€Œè§£ç æœ€å°æ•´æ•°çš„å‡½æ•°è¢«è®¾ç½®æˆå†…è”å‡½æ•°ï¼Œè¿™æ ·æ•ˆç‡å°±ä¼šæå‡å¾ˆå¤š</span><br><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-title">GetVarint64Ptr</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *p, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *limit, <span class="hljs-type">uint64_t</span> *value)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-type">uint64_t</span> result = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// è¿™ä¸ªå‡½æ•°å†…éƒ¨ä¸GetVarint32PtrFallbackä¸€è‡´</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> shift = <span class="hljs-number">0</span>; shift &lt;= <span class="hljs-number">63</span> &amp;&amp; p &lt; limit; shift += <span class="hljs-number">7</span>)<br>    {<br>        <span class="hljs-type">uint64_t</span> byte = *(<span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> *&gt;(p));<br>        p++;<br>        <span class="hljs-keyword">if</span> (byte &amp; <span class="hljs-number">128</span>)<br>        {<br>            result |= ((byte &amp; <span class="hljs-number">127</span>) &lt;&lt; shift);<br>        }<br>        <span class="hljs-keyword">else</span><br>        {<br>            result |= (byte &lt;&lt; shift);<br>            *value = result;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">const</span> <span class="hljs-type">char</span> *&gt;(p);<br>        }<br>    }<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>}<br><br><span class="hljs-comment">/*=============Putä¸Getæ–¹æ³•=============*/</span><br><br><span class="hljs-comment">// æŠŠ32ä½å®šé•¿è½¬æ¢æˆå­—ç¬¦ä¸²</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PutFixed32</span><span class="hljs-params">(std::string *dst, <span class="hljs-type">uint32_t</span> value)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// è®¾ç½®ä¸€ä¸ªç¼“å­˜åŒºï¼Œç„¶åæŠŠvalueç¼–ç åˆ°ç¼“å­˜åŒºåæ’å…¥</span><br>    <span class="hljs-type">char</span> buf[<span class="hljs-built_in">sizeof</span>(value)];<br>    <span class="hljs-built_in">EncodeFixed32</span>(buf, value);<br>    dst-&gt;<span class="hljs-built_in">append</span>(buf, <span class="hljs-built_in">sizeof</span>(buf));<br>}<br><br><span class="hljs-comment">// æŠŠ64ä½å®šé•¿è½¬åŒ–æˆå­—ç¬¦ä¸²</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PutFixed64</span><span class="hljs-params">(std::string *dst, <span class="hljs-type">uint64_t</span> value)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// è®¾ç½®ä¸€ä¸ªç¼“å­˜åŒºï¼Œç„¶åæŠŠvalueç¼–ç åˆ°ç¼“å­˜åŒºåæ’å…¥</span><br>    <span class="hljs-type">char</span> buf[<span class="hljs-built_in">sizeof</span>(value)];<br>    <span class="hljs-built_in">EncodeFixed64</span>(buf, value);<br>    dst-&gt;<span class="hljs-built_in">append</span>(buf, <span class="hljs-built_in">sizeof</span>(buf));<br>}<br><br><span class="hljs-comment">// æŠŠ32ä½å˜é•¿è½¬åŒ–æˆå­—ç¬¦ä¸²</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PutVarint32</span><span class="hljs-params">(std::string *dst, <span class="hljs-type">uint32_t</span> v)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// è®¾ç½®æœ€å¤§çš„ç¼“å†²åŒºï¼Œæ³¨æ„EncodeVarint32ä¼šè¿”å›æŒ‡å‘ç¼–ç åçš„ä¸€ä¸ªå­—èŠ‚çš„æŒ‡é’ˆ</span><br>    <span class="hljs-comment">// æ‰€ä»¥å°±èƒ½æ ¹æ®æŒ‡é’ˆåç§»æ¥è®¡ç®—å‡ºå½“å‰å˜é•¿æ•´æ•°çš„é•¿åº¦</span><br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">5</span>];<br>    <span class="hljs-type">char</span> *ptr = <span class="hljs-built_in">EncodeVarint32</span>(buf, v);<br>    dst-&gt;<span class="hljs-built_in">append</span>(buf, ptr - buf);<br>}<br><br><span class="hljs-comment">// æŠŠ64ä½å˜é•¿è½¬åŒ–æˆå­—ç¬¦ä¸²</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PutVarint64</span><span class="hljs-params">(std::string *dst, <span class="hljs-type">uint64_t</span> v)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// åŸç†å’ŒPutVarint32ä¸€æ ·ï¼Œåªæ˜¯ç¼“å†²åŒºå¤§å°å¤§äº†ä¸€äº›</span><br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">10</span>];<br>    <span class="hljs-type">char</span> *ptr = <span class="hljs-built_in">EncodeVarint64</span>(buf, v);<br>    dst-&gt;<span class="hljs-built_in">append</span>(buf, ptr - buf);<br>}<br><br><span class="hljs-comment">// æŠŠsliceè½¬åŒ–æˆå­—ç¬¦ä¸²å­˜å‚¨</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PutLengthPrefixedSlice</span><span class="hljs-params">(std::string *dst, <span class="hljs-type">const</span> Slice &amp;value)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// å­—ç¬¦ä¸²çš„ç¼–ç æ ¼å¼æ˜¯é•¿åº¦åœ¨å‰ï¼Œç„¶åæ˜¯å­—ç¬¦ä¸²æœ¬èº«</span><br>    <span class="hljs-comment">// æ‰€ä»¥æŒ‰ç…§å®šä¹‰å°±å¯ä»¥æ’å…¥äº†</span><br>    <span class="hljs-comment">// å…ˆæ’å…¥é•¿åº¦ï¼Œç„¶åæŠŠå­—ç¬¦ä¸²ç§»åŠ¨è¿‡å»</span><br>    <span class="hljs-comment">// ç”±äºSliceæœ«å°¾ä¸éœ€è¦'\0'ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šé•¿åº¦</span><br>    <span class="hljs-built_in">PutVarint32</span>(dst, value.<span class="hljs-built_in">size</span>());<br>    dst-&gt;<span class="hljs-built_in">append</span>(value.<span class="hljs-built_in">data</span>(), value.<span class="hljs-built_in">size</span>());<br>}<br><br><span class="hljs-comment">// è®¡ç®—å˜é•¿æ•´æ•°çš„é•¿åº¦</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">VarintLength</span><span class="hljs-params">(<span class="hljs-type">uint64_t</span> v)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// è¿™ä¸ªå‡½æ•°æ€è·¯å¾ˆç®€å•ï¼Œä¸è§£æäº†</span><br>    <span class="hljs-type">int</span> len = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">while</span> (v &gt;= <span class="hljs-number">128</span>)<br>    {<br>        v &gt;&gt;= <span class="hljs-number">7</span>;<br>        len++;<br>    }<br>    <span class="hljs-keyword">return</span> len;<br>}<br><br><span class="hljs-comment">// ä»å­—ç¬¦ä¸²ä¸­è·å–32ä½å˜é•¿</span><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">GetVarint32</span><span class="hljs-params">(Slice *input, <span class="hljs-type">uint32_t</span> *value)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *p = input-&gt;<span class="hljs-built_in">data</span>();                   <span class="hljs-comment">// å…ˆæ‹¿åˆ°å­—ç¬¦ä¸²çš„é¦–æŒ‡é’ˆ</span><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *limit = p + input-&gt;<span class="hljs-built_in">size</span>();           <span class="hljs-comment">// ç„¶åè·å–å°¾éƒ¨åœ°å€</span><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *q = <span class="hljs-built_in">GetVarint32Ptr</span>(p, limit, value); <span class="hljs-comment">//å…ˆè§£ç å‡ºæ•°æ®</span><br>    <span class="hljs-keyword">if</span> (q == <span class="hljs-literal">nullptr</span>)<br>    {<br>        <span class="hljs-comment">// æ‰€è¯·æ±‚å…ƒç´ ä¸åˆæ³•</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>        <span class="hljs-comment">// ç”±äºä¸€ä¸ªå­—ç¬¦ä¸²å¯èƒ½å†…éƒ¨ä¸æ­¢ä¸€ä¸ªæ•´æ•°</span><br>        <span class="hljs-comment">// è§£ç å®Œä¸€ä¸ªæ•´æ•°åå¯èƒ½è¿˜å‰©ä½™ä¸€éƒ¨åˆ†æœªè§£ç çš„æ•°æ®</span><br>        <span class="hljs-comment">// æ¯”å¦‚å­—ç¬¦ä¸²å­˜å‚¨æ ¼å¼æ˜¯å‰é¢ä¸€ä¸ª32ä½å˜é•¿+å­—ç¬¦ä¸²æœ¬èº«</span><br>        *input = <span class="hljs-built_in">Slice</span>(q, limit - q);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    }<br>}<br><br><span class="hljs-comment">// ä»å­—ç¬¦ä¸²ä¸­è·å–64ä½å˜é•¿</span><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">GetVarint64</span><span class="hljs-params">(Slice *input, <span class="hljs-type">uint64_t</span> *value)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// åŒä¸Šï¼Œåªæ˜¯éƒ¨åˆ†æ¥å£ä¸ä¸€æ ·</span><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *p = input-&gt;<span class="hljs-built_in">data</span>();<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *limit = p + input-&gt;<span class="hljs-built_in">size</span>();<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *q = <span class="hljs-built_in">GetVarint64Ptr</span>(p, limit, value);<br>    <span class="hljs-keyword">if</span> (q == <span class="hljs-literal">nullptr</span>)<br>    {<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>        *input = <span class="hljs-built_in">Slice</span>(q, limit - q);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    }<br>}<br><br><span class="hljs-comment">// è§£ç å‡ºå­—ç¬¦ä¸²</span><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">GetLengthPrefixedSlice</span><span class="hljs-params">(Slice *input, Slice *result)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-type">uint32_t</span> len;<br>    <span class="hljs-comment">// å…ˆè·å–é•¿åº¦ï¼Œç„¶åæ ¹æ®é•¿åº¦å»è§£ç </span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">GetVarint32</span>(input, &amp;len) &amp;&amp; input-&gt;<span class="hljs-built_in">size</span>() &gt;= len)<br>    {<br>        *result = <span class="hljs-built_in">Slice</span>(input-&gt;<span class="hljs-built_in">data</span>(), len);<br>        input-&gt;<span class="hljs-built_in">remove_prefix</span>(len);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    }<br>}<br><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œå…³äºå­—ç¬¦ä¸²çš„è§£ç éƒ¨åˆ†æˆ‘è®¤ä¸ºè¿˜æ˜¯å¾ˆå·§å¦™çš„ï¼Œå› ä¸ºå­—ç¬¦ä¸²ç¼–ç åçš„é•¿åº¦åœ¨å‰ï¼Œä¸”é•¿åº¦æ˜¯ä¸€ä¸ªå˜é•¿æ•´æ•°ï¼Œæ‰€ä»¥è§£ç æ—¶éœ€è¦å…ˆæå–å‡ºé•¿åº¦ã€‚æ­£å¸¸æƒ…å†µä¸‹çš„å†™æ³•å¯èƒ½æ˜¯å…ˆå¯¹æ•´ä¸ªç¼–ç åå­—ç¬¦ä¸²éå†ï¼Œè§£æå‡ºå‰é¢çš„é•¿åº¦ï¼Œè®°å½•ä¸‹è¿™ä¸ªå­—ç¬¦ä¸²é•¿åº¦ä»¥åŠå˜é•¿æ•´æ•°çš„é•¿åº¦åå†å»å¤„ç†åé¢çš„å­—ç¬¦ä¸²ã€‚</p><img src="/2022/08/30/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-4/pic2.png" class="" title="_"><p>ä½†æ˜¯levelDBä¸­çš„å¤„ç†æ–¹å¼æ˜¯è®©å˜é•¿è§£ç å‡½æ•°è§£ç å¤šå°‘å°±æŠŠè¾“å…¥ä¸­è§£ç çš„è¿™æ®µæ•°æ®ç»™å¼„æ‰(ä¿®æ”¹äº†æºå­—ç¬¦ä¸²çš„æŒ‡é’ˆ)ï¼Œå› ä¸ºè¿™éƒ¨åˆ†éœ€è¦è§£ç çš„å€¼å·²ç»è¢«è§£æå‡ºæ¥å¹¶è¿”å›äº†ï¼Œä¹Ÿå°±ä¸å†éœ€è¦äº†ã€‚</p><img src="/2022/08/30/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-4/pic3.png" class="" title="_"><p><strong><em>æ¯ä¸ªè§£ç å‡½æ•°åªå¤„ç†å­—ç¬¦ä¸²å¼€å¤´ï¼Œå¹¶ä¸”å¤„ç†å®ŒæˆååŠæ—¶æ”¹å˜å­—ç¬¦ä¸²çš„é¦–åœ°å€(åç§»)ï¼Œè¿™æ ·å°±ä¸éœ€è¦è®°å½•è¿™éƒ¨åˆ†çš„çŠ¶æ€å¹¶è€ƒè™‘å¤„ç†ç»†èŠ‚äº†</em></strong></p><p>èƒ½å¤Ÿè¿™æ ·åšçš„åŸå› å°±æ˜¯é€šè¿‡ä¼ é€’è¶…å°¾å…ƒç´ æ¥æ ‡å®šç•Œé™ï¼ŒåŒæ—¶æ‰€æœ‰å¤„ç†å‡½æ•°éƒ½ä»¥æŒ‡é’ˆä½œä¸ºæ•°æ®ä¼ é€’çš„æ–¹å¼(ç»Ÿä¸€æ¥å£æ ‡å‡†)ã€‚</p><p>è€Œç›´æ¥ç§»åŠ¨å­—ç¬¦ä¸²æŒ‡é’ˆå¾ˆå®¹æ˜“å°±å¼•å‡ºå¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šä¼šä¸ä¼šå†…å­˜æ³„æ¼å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ä¸ä¼šï¼Œå› ä¸ºå†…å­˜å¹¶ä¸ç”±Sliceç®¡ç†ï¼ŒSliceåªæ˜¯å¯¹åº•å±‚å­—ç¬¦ä¸²åšå‡ºäº†æ˜ å°„è€Œå·²ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯ç”¨äºä¼ é€’ï¼Œåç»­æˆ‘ä»¬ä¼šå¯¹Sliceè¿›è¡Œè§£æã€‚</p><p>å†ç‰¹æ„æŠŠè¿™æ®µä»£ç è´´å‡ºæ¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">GetVarint32</span><span class="hljs-params">(Slice *input, <span class="hljs-type">uint32_t</span> *value)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *p = input-&gt;<span class="hljs-built_in">data</span>();                   <span class="hljs-comment">// å…ˆæ‹¿åˆ°å­—ç¬¦ä¸²çš„é¦–æŒ‡é’ˆ</span><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *limit = p + input-&gt;<span class="hljs-built_in">size</span>();           <span class="hljs-comment">// ç„¶åè·å–å°¾éƒ¨åœ°å€</span><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *q = <span class="hljs-built_in">GetVarint32Ptr</span>(p, limit, value); <span class="hljs-comment">//å…ˆè§£ç å‡ºæ•°æ®ï¼Œqæ˜¯è¶…å°¾å…ƒç´ (ç›¸å¯¹å˜é•¿æ•´æ•°è€Œè¨€)</span><br>    <span class="hljs-keyword">if</span> (q == <span class="hljs-literal">nullptr</span>)<br>    {<br>        <span class="hljs-comment">// æ‰€è¯·æ±‚å…ƒç´ ä¸åˆæ³•</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>        <span class="hljs-comment">// ç”±äºä¸€ä¸ªå­—ç¬¦ä¸²å¯èƒ½å†…éƒ¨ä¸æ­¢ä¸€ä¸ªæ•´æ•°</span><br>        <span class="hljs-comment">// è§£ç å®Œä¸€ä¸ªæ•´æ•°åå¯èƒ½è¿˜å‰©ä½™ä¸€éƒ¨åˆ†æœªè§£ç çš„æ•°æ®</span><br>        <span class="hljs-comment">// æ¯”å¦‚å­—ç¬¦ä¸²å­˜å‚¨æ ¼å¼æ˜¯å‰é¢ä¸€ä¸ª32ä½å˜é•¿+å­—ç¬¦ä¸²æœ¬èº«</span><br>        *input = <span class="hljs-built_in">Slice</span>(q, limit - q);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    }<br>}<br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">GetLengthPrefixedSlice</span><span class="hljs-params">(Slice *input, Slice *result)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-type">uint32_t</span> len;<br>    <span class="hljs-comment">// å…ˆè·å–é•¿åº¦ï¼Œç„¶åæ ¹æ®é•¿åº¦å»è§£ç </span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">GetVarint32</span>(input, &amp;len) &amp;&amp; input-&gt;<span class="hljs-built_in">size</span>() &gt;= len)<br>    {<br>        *result = <span class="hljs-built_in">Slice</span>(input-&gt;<span class="hljs-built_in">data</span>(), len);<br>        input-&gt;<span class="hljs-built_in">remove_prefix</span>(len);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    }<br>}<br><br></code></pre></td></tr></table></figure><hr><h2 id="æ€»ç»“éƒ¨åˆ†">æ€»ç»“éƒ¨åˆ†</h2><table><thead><tr class="header"><th style="text-align: center;">å‡½æ•°/å˜é‡</th><th style="text-align: center;">ä½œç”¨</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">inline void EncodeFixed32(char *dst,uint32_t value)</td><td style="text-align: center;">ç¼–ç å®šé•¿32ä½æ•´æ•°</td></tr><tr class="even"><td style="text-align: center;">inline void EncodeFixed64(char *dst,uint64_t value)</td><td style="text-align: center;">ç¼–ç å®šé•¿64ä½æ•´æ•°</td></tr><tr class="odd"><td style="text-align: center;">inline uint32_t DecodeFixed32(const char*ptr)</td><td style="text-align: center;">è§£ç 32ä½å®šé•¿æ•´æ•°</td></tr><tr class="even"><td style="text-align: center;">inline uint64_t DecodeFixed64(const char*ptr)</td><td style="text-align: center;">è§£ç 64ä½å®šé•¿æ•´æ•°</td></tr><tr class="odd"><td style="text-align: center;">char <em>EncodeVarint32(char </em>dst,uint32_t v)</td><td style="text-align: center;">ç¼–ç 32ä½å˜é•¿æ•´æ•°</td></tr><tr class="even"><td style="text-align: center;">char <em>EncodeVarint64(char </em>dst,uint64_t v)</td><td style="text-align: center;">ç¼–ç 64ä½å˜é•¿æ•´æ•°</td></tr><tr class="odd"><td style="text-align: center;">inline const char<em>GetVarint32Ptr(const char </em>p, const char <em>limit, uint32_t</em>value)</td><td style="text-align: center;">è§£ç 32ä½å˜é•¿æ•´æ•°</td></tr><tr class="even"><td style="text-align: center;">const char<em>GetVarint32PtrFallback(const char </em>p, const char<em>limit,uint32_t </em>value)</td><td style="text-align: center;">è§£ç 32ä½å˜é•¿æ•´æ•°ä¸­å¤§äº127çš„æ•°å­—ï¼Œè¢«GetVarint32Ptrè°ƒç”¨</td></tr><tr class="odd"><td style="text-align: center;">const char <em>GetVarint64Ptr(const char</em>p, const char <em>limit, uint64_t </em>value)</td><td style="text-align: center;">è§£ç 64ä½å˜é•¿æ•´æ•°çš„å‡½æ•°</td></tr><tr class="even"><td style="text-align: center;">void PutFixed32(std::string *dst,uint32_t value)</td><td style="text-align: center;">æŠŠ32ä½å®šé•¿è½¬æ¢æˆå­—ç¬¦ä¸²</td></tr><tr class="odd"><td style="text-align: center;">void PutFixed64(std::string *dst,uint64_t value)</td><td style="text-align: center;">æŠŠ64ä½å®šé•¿è½¬åŒ–æˆå­—ç¬¦ä¸²</td></tr><tr class="even"><td style="text-align: center;">void PutVarint32(std::string *dst,uint32_t v)</td><td style="text-align: center;">æŠŠ32ä½å˜é•¿è½¬åŒ–æˆå­—ç¬¦ä¸²</td></tr><tr class="odd"><td style="text-align: center;">void PutVarint64(std::string *dst,uint64_t v)</td><td style="text-align: center;">æŠŠ64ä½å˜é•¿è½¬åŒ–æˆå­—ç¬¦ä¸²</td></tr><tr class="even"><td style="text-align: center;">void PutLengthPrefixedSlice(std::string*dst, const Slice &amp;value)</td><td style="text-align: center;">æŠŠsliceè½¬åŒ–æˆå­—ç¬¦ä¸²å­˜å‚¨</td></tr><tr class="odd"><td style="text-align: center;">int VarintLength(uint64_t v)</td><td style="text-align: center;">è®¡ç®—å˜é•¿æ•´æ•°çš„é•¿åº¦</td></tr><tr class="even"><td style="text-align: center;">bool GetVarint32(Slice <em>input,uint32_t </em>value)</td><td style="text-align: center;">ä»å­—ç¬¦ä¸²ä¸­è·å–32ä½å˜é•¿</td></tr><tr class="odd"><td style="text-align: center;">bool GetVarint64(Slice <em>input,uint64_t </em>value)</td><td style="text-align: center;">ä»å­—ç¬¦ä¸²ä¸­è·å–64ä½å˜é•¿</td></tr><tr class="even"><td style="text-align: center;">bool GetLengthPrefixedSlice(Slice<em>input, Slice </em>result)</td><td style="text-align: center;">è§£ç å‡ºå­—ç¬¦ä¸²</td></tr></tbody></table><p>ç¼–ç è§£ç éƒ¨åˆ†ä½¿ç”¨åˆ°äº†å¾ˆå¤šä½çº§ç¼–ç¨‹ï¼Œè¿™éƒ¨åˆ†éƒ½å¾ˆæœ‰æ„æ€ï¼Œå¯ä»¥åšåˆ°å››ä¸¤æ‹¨åƒæ–¤çš„ä½œç”¨ã€‚</p><div class="note note-primary">            <h3 id="ç¼–ç¨‹å°æŠ€å·§">ç¼–ç¨‹å°æŠ€å·§</h3><ul><li><p>åœ¨å‡½æ•°å†…éœ€è¦ç”¨åˆ°çš„å¸¸é‡å¯ä»¥å®šä¹‰æˆå†…éƒ¨é™æ€å¸¸é‡<code>static const</code>ï¼Œè¿™æ ·å°±é¿å…äº†å…¨å±€å˜é‡çš„é¢å¤–å¼€é”€ä¸æƒé™æ··ä¹±ã€åŒæ—¶ä¹Ÿèƒ½é¿å…å±€éƒ¨å˜é‡çš„æ¯æ¬¡éƒ½éœ€è¦é¢å¤–åˆ†é…çš„å¼€é”€ã€‚</p></li><li><p>å½“å‡½æ•°æ˜¯å¤„ç†è¿ç»­çš„åŒºé—´æ—¶ï¼Œé¢„ç•™å‡ºè¶…å°¾å…ƒç´ æ¥å£æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p></li></ul>          </div>]]></content>
    
    
    <categories>
      
      <category>levelDBæºç å‰–æ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>levelDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>levelDBæºç å‰–æ(3)</title>
    <link href="/2022/08/29/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-3/"/>
    <url>/2022/08/29/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-3/</url>
    
    <content type="html"><![CDATA[<h2 id="leveldbçš„å†…å­˜ç®¡ç†ç­–ç•¥">levelDBçš„å†…å­˜ç®¡ç†ç­–ç•¥</h2><span id="more"></span><hr><h3 id="leveldbçš„å†…å­˜ç®¡ç†ç±»arena">levelDBçš„å†…å­˜ç®¡ç†ç±»Arena</h3><div class="note note-primary">            <p>æºä»£ç ä½ç½®ï¼šutils/arena.cc utils/arena.h</p>          </div><p>å¯¹äºæ•°æ®åº“è€Œè¨€ï¼Œå†…å­˜ç®¡ç†ç­–ç•¥æ˜¯ååˆ†é‡è¦çš„ï¼Œå› ä¸ºå…¶æ­£æ˜¯éœ€è¦ä¸ºå­˜å…¥çš„æ•°æ®åˆ†é…å†…å­˜ï¼Œå€˜è‹¥ç›´æ¥ä½¿ç”¨new/deleteè¿™æ ·æ¯æ¬¡æ’å…¥æ•°æ®éƒ½å•ç‹¬å»åˆ†é…å†…å­˜ï¼Œæ•ˆç‡æ˜¯å¾ˆä½çš„ï¼ŒåŒæ—¶ç”±äºæ¯æ¡æ’å…¥çš„æ•°æ®çš„å¤§å°å¹¶ä¸ä¸€è‡´ï¼Œå¯¼è‡´ä¼šå‡ºç°è®¸å¤šçš„å†…å­˜ç¢ç‰‡ã€‚</p><p>å¯¹äºlevelDBè¿™æ ·ä¸€ä¸ªbillionçº§åˆ«çš„æ•°æ®åº“ï¼Œæ˜¾ç„¶å…¶ä¸èƒ½é‡‡å–è¿™æ ·çš„ç­–ç•¥ã€‚</p><p>åœ¨levelDBä¸­ï¼Œç”±äºåªæœ‰<code>MemTable</code>ä½äºå†…å­˜ä¸”éœ€è¦é¢‘ç¹çš„æ’å…¥ï¼Œæ‰€ä»¥å®ƒæœ€éœ€è¦å†…å­˜ç®¡ç†ï¼ŒlevelDBä¸­ç”¨äºå†…å­˜ç®¡ç†çš„ç±»ä¸º<code>Arena</code>ï¼Œæ¯ä¸ª<code>MemTable</code>éƒ½ç»‘å®šä¸€ä¸ª<code>Arena</code>ã€‚è€Œå…¶ä½™çš„éƒ¨åˆ†åˆ™ç›´æ¥ä½¿ç”¨new/deleteï¼Œå› ä¸ºè¿™äº›éƒ¨åˆ†è¦ä¹ˆæ˜¯ä¸é¢‘ç¹ï¼Œè¦ä¹ˆæ˜¯å—æœ¬èº«å°±å¾ˆå¤§ã€‚</p><h4 id="arenaç±»">Arenaç±»</h4><div class="note note-info">            <p><strong>åŸºæœ¬æ€æƒ³</strong>ï¼šå…ˆåˆ†é…å‡ºä¸€å¤§å—å†…å­˜ï¼Œç„¶åå½“éœ€è¦ç”¨åˆ°å†…å­˜æ—¶ï¼Œå°±åœ¨è¿™ä¸€å¤§å—å†…å­˜ä¸­ç§»åŠ¨æŒ‡é’ˆï¼Œè¿™æ ·å°±èƒ½è§£å†³å°å—å†…å­˜é¢‘ç¹è°ƒç”¨newå’Œå†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä¸è¿‡ç¼ºç‚¹æ˜¯æœ‰ä¸€éƒ¨åˆ†å†…å­˜è¢«æµªè´¹æ‰ã€‚</p>          </div><p>æˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹ä¸€ä¸‹arenaç±»çš„å¤´æ–‡ä»¶æã€‚ä»å¤´æ–‡ä»¶ä¸­å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°å…¶ç”¨äºå†…å­˜åˆ†é…çš„æ–¹æ³•å°±æ˜¯å…¬æœ‰å‡½æ•°<code>Allocate</code>å’Œ<code>AllocateAligned</code>ï¼ŒåŒºåˆ«æ˜¯åè€…æä¾›å†…å­˜å¯¹é½ï¼Œè¿™å¯¹æ•ˆç‡ä¹Ÿæœ‰æå‡ã€‚</p><h5 id="å¤´æ–‡ä»¶">å¤´æ–‡ä»¶</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// utils/arena.h</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Arena</span><br>{<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Arena</span>();                                  <span class="hljs-comment">//é»˜è®¤æ„é€ å‡½æ•°</span><br>    <span class="hljs-built_in">Arena</span>(<span class="hljs-type">const</span> Arena &amp;) = <span class="hljs-keyword">delete</span>;            <span class="hljs-comment">//å…³é—­å¤åˆ¶æ„é€ å‡½æ•°</span><br>    Arena &amp;<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Arena &amp;) = <span class="hljs-keyword">delete</span>; <span class="hljs-comment">//å…³é—­ä½¿ç”¨=çš„æ‹·è´æ„é€ å‡½æ•°</span><br>    ~<span class="hljs-built_in">Arena</span>();                                 <span class="hljs-comment">//ææ„å‡½æ•°</span><br><br>    <span class="hljs-comment">//è¿”å›ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ–°åˆ†é…çš„å†…å­˜åŒºåŸŸï¼Œå³å†…éƒ¨çš„åˆ†é…å†…å­˜çš„æ–¹æ³•</span><br>    <span class="hljs-function"><span class="hljs-type">char</span> *<span class="hljs-title">Allocate</span><span class="hljs-params">(<span class="hljs-type">size_t</span> bytes)</span></span>;<br><br>    <span class="hljs-comment">//åŒAllocateï¼Œä½†æ˜¯æä¾›äº†å†…å­˜å¯¹é½ç­–ç•¥</span><br>    <span class="hljs-function"><span class="hljs-type">char</span> *<span class="hljs-title">AllocateAligned</span><span class="hljs-params">(<span class="hljs-type">size_t</span> bytes)</span></span>;<br><br>    <span class="hljs-comment">//è¿”å›ç›®å‰ä»å†…å­˜ä¸­ç”³è¯·çš„å†…å­˜å¤§å°ï¼Œç”±äºmemory_usage_æ˜¯åŸå­æ“ä½œ</span><br>    <span class="hljs-comment">//æ­¤å¤„çš„memory_order_relaxedè¡¨ç¤ºå®½æ¾å†…å­˜åºï¼Œå³ä»»ä½•ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ä»»æ„æ›´æ–°</span><br>    <span class="hljs-comment">//ä¸ç”¨åŒæ­¥åˆ°å…¶ä»–çº¿ç¨‹ä¸­ï¼Œä¸‹ä¸€ä¸ªè®¿é—®è¯¥å…ƒç´ çš„çº¿ç¨‹è·å–åˆ°æ›´æ–°ä¹‹åçš„å€¼</span><br>    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">MemoryUsage</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function">    </span>{<br>        <span class="hljs-keyword">return</span> memory_usage_.<span class="hljs-built_in">load</span>(std::memory_order_relaxed);<br>    }<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-type">char</span> *<span class="hljs-title">AllocateFallback</span><span class="hljs-params">(<span class="hljs-type">size_t</span> bytes)</span></span>;       <span class="hljs-comment">//è·å–æ–°åˆ†é…çš„å†…å­˜ï¼Œè¢«AllocateAlignedå’ŒAllocateè°ƒç”¨</span><br>    <span class="hljs-function"><span class="hljs-type">char</span> *<span class="hljs-title">AllocateNewBlock</span><span class="hljs-params">(<span class="hljs-type">size_t</span> block_bytes)</span></span>; <span class="hljs-comment">//newå‡½æ•°çš„åŒ…è£…ï¼Œè¢«AllocateFallbackè°ƒç”¨</span><br><br>    <span class="hljs-type">char</span> *alloc_ptr_;                  <span class="hljs-comment">//å½“å‰å†…å­˜å—æœªä½¿ç”¨å†…å­˜çš„é¦–åœ°å€</span><br>    <span class="hljs-type">size_t</span> alloc_bytes_remaining_;     <span class="hljs-comment">//å½“å‰å†…å­˜å—ä¸­æœªä½¿ç”¨ç©ºé—´çš„å¤§å°</span><br>    std::vector&lt;<span class="hljs-type">char</span> *&gt; blocks_;       <span class="hljs-comment">//å­˜å‚¨æ¯ä¸€æ¬¡å‘ç³»ç»Ÿè¯·æ±‚åˆ†é…çš„å†…å­˜å—çš„æŒ‡é’ˆ</span><br>    std::atomic&lt;<span class="hljs-type">size_t</span>&gt; memory_usage_; <span class="hljs-comment">//è®°å½•å·²ç”³è¯·å…¨éƒ¨å†…å­˜ä½¿ç”¨çš„æ•°ç›®ï¼Œæ³¨æ„æ­¤æ“ä½œæ˜¯åŸå­çš„</span><br>};<br></code></pre></td></tr></table></figure><p>å¤´æ–‡ä»¶å®šä¹‰äº†Arenaè¿™ä¸ªç±»ï¼Œåœ¨ç±»ä¸­åªæœ‰3ä¸ªå…¬æœ‰æ–¹æ³•ï¼Œåˆ†åˆ«ç”¨äºè¿”å›å°å†…å­˜ã€å¯¹é½çš„å°å†…å­˜ã€å½“å‰ç±»å ç”¨çš„ç©ºé—´ã€‚</p><h5 id="å®ç°æ–‡ä»¶">å®ç°æ–‡ä»¶</h5><p>åˆ†æå®Œäº†å¤´æ–‡ä»¶ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å®ƒçš„cppå®ç°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs C++"><br><span class="hljs-comment">/*=============ç±»çš„æ„é€ ææ„ç­‰åŸºç¡€å‡½æ•°=============*/</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">int</span> kBlockSize = <span class="hljs-number">4096</span>; <span class="hljs-comment">//ä¸€ä¸ªå†…å­˜å—çš„å¤§å°</span><br><br><span class="hljs-comment">// æ„é€ å‡½æ•°ï¼Œé»˜è®¤çš„æ„é€ å‡½æ•°ç›´æ¥å¯¹å†…éƒ¨çš„å‡ ä¸ªå…ƒç´ è¿›è¡Œåˆå§‹åŒ–</span><br>Arena::<span class="hljs-built_in">Arena</span>()<br>    : <span class="hljs-built_in">alloc_ptr_</span>(<span class="hljs-literal">nullptr</span>), <span class="hljs-built_in">alloc_bytes_remaining_</span>(<span class="hljs-number">0</span>), <span class="hljs-built_in">memory_usage_</span>(<span class="hljs-number">0</span>) {}<br><br><span class="hljs-comment">// ææ„å‡½æ•°ï¼Œæ³¨æ„ï¼Œç”±äºç±»ä¸­å­˜åœ¨ä¸€ä¸ªvectoræ•°ç»„å­˜å‚¨äº†æ¯æ¬¡åˆ†é…çš„å†…å­˜çš„å—çš„æŒ‡é’ˆ</span><br><span class="hljs-comment">// æ‰€ä»¥ææ„çš„æ—¶å€™éå†è¿™ä¸ªæ•°ç»„ç„¶åé€ä¸ªdelete</span><br>Arena::~<span class="hljs-built_in">Arena</span>()<br>{<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; blocks_.<span class="hljs-built_in">size</span>(); i++)<br>    {<br>        <span class="hljs-keyword">delete</span>[] blocks_[i];<br>    }<br>}<br><br><span class="hljs-comment">/*=============å…¬æœ‰æ¥å£=============*/</span><br><br><span class="hljs-comment">// åˆ†é…å°å†…å­˜çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯æ­¤ç±»å¯¹å¤–çš„æ¥å£ï¼Œè¢«å†™æˆå†…è”å‡½æ•°æ•ˆç‡æ›´é«˜</span><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">char</span> *<span class="hljs-title">Arena::Allocate</span><span class="hljs-params">(<span class="hljs-type">size_t</span> bytes)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// é¦–å…ˆï¼Œæ–­è¨€ç”³è¯·çš„å†…å­˜æ•°ç›®æ˜¯å¦åˆæ³•</span><br>    <span class="hljs-built_in">assert</span>(bytes &gt; <span class="hljs-number">0</span>);<br>    <span class="hljs-comment">// å½“ä»å†…å­˜ç”³è¯·çš„æ•´å—ä¸­ä»ç„¶å­˜åœ¨ç©ºé—´æ—¶ï¼Œå°±ç›´æ¥ä»è¿™ä¸ªå—ä¸­åˆ†é…</span><br>    <span class="hljs-keyword">if</span> (bytes &lt;= alloc_bytes_remaining_)<br>    {<br>        <span class="hljs-type">char</span> *result = alloc_ptr_;<br>        alloc_ptr_ += bytes;<br>        alloc_bytes_remaining_ -= bytes;<br>        <span class="hljs-keyword">return</span> result;<br>    }<br>    <span class="hljs-comment">// å¦åˆ™è°ƒç”¨AllocateFallbackè¿›è¡Œåˆ†é…ï¼ˆä»å†…å­˜ä¸­ç”³è¯·ç©ºé—´å»åˆ†é…ï¼‰</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">AllocateFallback</span>(bytes);<br>}<br><br><span class="hljs-comment">// é‡‡ç”¨å¯¹é½çš„æ–¹å¼å»åˆ†é…å†…å­˜ï¼Œåªæ¯”Allocateå¤šå‡ºè®¡ç®—éœ€è¦åˆ†é…å†…å­˜çš„æ­¥éª¤</span><br><span class="hljs-function"><span class="hljs-type">char</span> *<span class="hljs-title">Arena::AllocateAligned</span><span class="hljs-params">(<span class="hljs-type">size_t</span> bytes)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// é¦–å…ˆè®¾ç½®å¯¹é½çš„å­—èŠ‚æ•°ï¼Œ(sizeof(void *)å¯ä»¥è®¡ç®—å‡ºå½“å‰æœºå™¨çš„æ¯ä¸ªæŒ‡é’ˆçš„å­—èŠ‚æ•°</span><br>    <span class="hljs-comment">// æœ€å¤š8å­—èŠ‚å¯¹é½ï¼Œå½“å½“å‰æœºå™¨æŒ‡é’ˆçš„å­—èŠ‚æ•°ä¸è¶³8å­—èŠ‚æ—¶ï¼Œä¼šä½¿ç”¨å½“å‰æœºå™¨çš„å­—èŠ‚æ•°</span><br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> align = (<span class="hljs-built_in">sizeof</span>(<span class="hljs-type">void</span> *) &gt; <span class="hljs-number">8</span>) ? <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">void</span> *) : <span class="hljs-number">8</span>;<br><br>    <span class="hljs-comment">// é™æ€æ–­è¨€ï¼Œåœ¨ç¼–è¯‘æ—¶æ‰§è¡Œæ–­è¨€</span><br>    <span class="hljs-comment">// a&amp;(a-1)çš„åŠŸèƒ½æ˜¯å»æ‰å³è¾¹çš„1(äºŒè¿›åˆ¶)ï¼Œæ‰€ä»¥å½“ä¸æ˜¯2çš„å¹‚æ¬¡æ–¹æ—¶ï¼Œå»æ‰1åå°±é0</span><br>    <span class="hljs-built_in">static_assert</span>((align &amp; (align - <span class="hljs-number">1</span>)) == <span class="hljs-number">0</span>,<br>                  <span class="hljs-string">"Pointer size should be a power of 2"</span>);<br><br>    <span class="hljs-comment">// ä¸‹é¢è¿™é‡Œçš„ä½è¿ç®—ç­‰ä»·äºæ±‚ä½™è¿ç®—</span><br>    <span class="hljs-comment">// å› ä¸ºä¸Šé¢è¿™ä¸ªæ–­è¨€å·²ç»ç¡®ä¿äº†alignæ˜¯2ä¸ªå¹‚æ¬¡æ–¹ï¼Œå› æ­¤align-1æ˜¯ä¸€ä¸ªå³ä¾§å‡ä¸º1çš„æ©æ¨¡</span><br>    <span class="hljs-comment">// ä¸¤è€…ç›¸ä¸çš„ç»“æœå°±å¯ä»¥å¿«é€Ÿæ±‚å‡ºalloc_ptr_%align</span><br>    <span class="hljs-comment">// ä½†æ³¨æ„ï¼Œæ­¤æ—¶ä¸¤è€…èƒ½å¤Ÿç­‰ä»·çš„é‡è¦åŸå› æ˜¯alignæ˜¯2çš„å¹‚æ¬¡æ–¹</span><br>    <span class="hljs-comment">// æ­¤å¤„è¿˜æœ‰å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä¹Ÿå°±æ˜¯æŠŠå–æ¨¡ç»“æœè½¬æ¢æˆuintptr_t</span><br>    <span class="hljs-type">size_t</span> current_mod = <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">uintptr_t</span>&gt;(alloc_ptr_) &amp; (align - <span class="hljs-number">1</span>);<br><br>    <span class="hljs-comment">// å½“å–æ¨¡ç»“æœä¸æ˜¯0å°±è¡¨ç¤ºéœ€è¦åˆ†é…çš„å†…å­˜æ˜¯2çš„æ•´æ•°å¹‚ï¼Œæ‰€ä»¥éœ€è¦é¢å¤–åˆ†é…ä¸€äº›å†…å­˜</span><br>    <span class="hljs-type">size_t</span> slop = (current_mod == <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : align - current_mod);<br><br>    <span class="hljs-comment">// è®¡ç®—å‡ºæ€»çš„éœ€è¦çš„å†…å­˜</span><br>    <span class="hljs-type">size_t</span> needed = bytes + slop;<br><br>    <span class="hljs-comment">/*-------- è‡³æ­¤ï¼Œè®¡ç®—å‡ºéœ€è¦å¯¹é½æ—¶åˆ†é…çš„å†…å­˜åï¼Œå°±ä¸Allocateæ— å¼‚ --------*/</span><br><br>    <span class="hljs-type">char</span> *result;<br><br>    <span class="hljs-comment">// å½“ä»å†…å­˜ç”³è¯·çš„æ•´å—ä¸­ä»ç„¶å­˜åœ¨ç©ºé—´æ—¶ï¼Œå°±ç›´æ¥ä»è¿™ä¸ªå—ä¸­åˆ†é…</span><br>    <span class="hljs-keyword">if</span> (needed &lt;= alloc_bytes_remaining_)<br>    {<br>        result = alloc_ptr_ + slop;<br>        alloc_ptr_ += needed;<br>        alloc_bytes_remaining_ -= needed;<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>        <span class="hljs-comment">// æ­¤å¤„å­˜åœ¨ä¸€ç‚¹ç‚¹åŒºåˆ«ï¼ŒAllocateFallbackç”³è¯·çš„å‚æ•°æ—¶bytesè€Œä¸æ˜¯å¯¹é½åçš„need</span><br>        <span class="hljs-comment">// è¿™æ˜¯å› ä¸ºAllocateFallbackè°ƒç”¨çš„æ˜¯new/deleteï¼Œæ€»æ˜¯å†…å­˜å¯¹é½çš„</span><br>        result = <span class="hljs-built_in">AllocateFallback</span>(bytes);<br>    }<br><br>    <span class="hljs-comment">// è¿™é‡Œå†åšä¸€ä¸‹æ–­è¨€ï¼Œä¿è¯å¯¹é½</span><br>    <span class="hljs-built_in">assert</span>((<span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">uintptr_t</span>&gt;(result) &amp; (align - <span class="hljs-number">1</span>)) == <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">return</span> result;<br>}<br><br><span class="hljs-comment">/*=============ç§æœ‰æ¥å£=============*/</span><br><br><span class="hljs-comment">// ç§æœ‰æ–¹æ³•ï¼šå›è°ƒå‡½æ•°ï¼Œç”¨äºå½“å½“å‰å—å†…å†…å­˜ä¸è¶³æ—¶ç”³è¯·å†…å­˜çš„ç­–ç•¥</span><br><span class="hljs-function"><span class="hljs-type">char</span> *<span class="hljs-title">Arena::AllocateFallback</span><span class="hljs-params">(<span class="hljs-type">size_t</span> bytes)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// å½“éœ€è¦çš„å†…å­˜è¶…è¿‡kBlockSizeçš„1/4ï¼Œï¼ˆé»˜è®¤1kbæ—¶ï¼‰ï¼Œç”³è¯·å’Œbytesç›¸åŒå¤§å°çš„å†…å­˜</span><br>    <span class="hljs-comment">// è¿™æ ·åšæ˜¯å› ä¸ºå½“éœ€è¦ç”¨åˆ°çš„å†…å­˜å·²ç»è¶…è¿‡å—å¤§å°çš„1/4äº†ï¼Œé‚£ä¹ˆä¹‹å‰å‰©ä½™çš„å—å¯èƒ½è¿˜æœ‰ä¸å°‘</span><br>    <span class="hljs-comment">// å¦‚æœæ–°åˆ†é…ä¸€ä¸ªå—é‚£ä¹ˆå°±å¯èƒ½ä¼šæµªè´¹æ¯”è¾ƒå¤šçš„å†…å­˜</span><br>    <span class="hljs-keyword">if</span> (bytes &gt; kBlockSize / <span class="hljs-number">4</span>)<br>    {<br>        <span class="hljs-type">char</span> *result = <span class="hljs-built_in">AllocateNewBlock</span>(bytes);<br>        <span class="hljs-keyword">return</span> result;<br>    }<br><br>    <span class="hljs-comment">// å½“éœ€è¦çš„å†…å­˜ä¸è¶³kBlockSizeçš„1/4ï¼Œï¼ˆé»˜è®¤1kbæ—¶ï¼‰ï¼Œå°±ç”³è¯·ä¸€ä¸ªæ•´ä¸ªçš„å—ï¼ˆé»˜è®¤4kbï¼‰</span><br>    <span class="hljs-comment">// ç„¶åä»è¿™é‡Œé¢åˆ†é…å†…å­˜</span><br>    <span class="hljs-comment">// ä½†æ³¨æ„ï¼Œè¿›å…¥åˆ°æ­¤å‡½æ•°é‡Œåªè¯´æ˜åŸæ¥çš„å—ä¸è¶³ä»¥åˆ†é…ç°åœ¨éœ€è¦çš„å†…å­˜ï¼Œä½†å…¶å¯èƒ½ä»ç„¶å‰©ä½™å†…å­˜</span><br>    <span class="hljs-comment">// æ­¤å¤„çš„ç­–ç•¥æ˜¯ç›´æ¥æŠŠåŸæ¥çš„å†…å­˜å—ä¸­å¯èƒ½å‰©ä½™çš„å†…å­˜ç»™æµªè´¹æ‰</span><br>    <span class="hljs-comment">// æ¯•ç«Ÿæ­¤æ—¶éœ€è¦åˆ†é…çš„å†…å­˜ä¸åˆ°1/4ä¸ªå—ï¼Œè¯´æ˜åŸæ¥çš„å—ä¹Ÿå‰©ä¸‹ä¸äº†å¤šå°‘å†…å­˜äº†</span><br>    alloc_ptr_ = <span class="hljs-built_in">AllocateNewBlock</span>(kBlockSize);<br><br>    <span class="hljs-comment">// ä¸‹é¢è¿™å‡ éƒ¨å°±æ˜¯åˆ†é…äº†ä¸€ä¸ªå—ååšå—å†…çš„å†…å­˜åˆ†é…</span><br>    alloc_bytes_remaining_ = kBlockSize;<br>    <span class="hljs-type">char</span> *result = alloc_ptr_;<br>    alloc_ptr_ += bytes;<br>    alloc_bytes_remaining_ -= bytes;<br>    <span class="hljs-keyword">return</span> result;<br>}<br><br><span class="hljs-comment">// ç§æœ‰æ–¹æ³•ï¼šå‘ç³»ç»Ÿç”³è¯·å†…å­˜</span><br><span class="hljs-function"><span class="hljs-type">char</span> *<span class="hljs-title">Arena::AllocateNewBlock</span><span class="hljs-params">(<span class="hljs-type">size_t</span> block_bytes)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// å°±æ˜¯å¯¹newçš„ä¸€å±‚åŒ…è£…ï¼ŒåŒæ—¶æ›´æ–°ä¸€ä¸‹ç±»å†…çš„å‚æ•°</span><br>    <span class="hljs-type">char</span> *result = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[block_bytes];<br>    blocks_.<span class="hljs-built_in">push_back</span>(result);<br>    memory_usage_.<span class="hljs-built_in">fetch_add</span>(block_bytes + <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">char</span> *),<br>                            std::memory_order_relaxed);<br>    <span class="hljs-keyword">return</span> result;<br>}<br></code></pre></td></tr></table></figure><img src="/2022/08/29/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-3/pic1.jpg" class="" title="_"><p>å®é™…ä¸Šæ€»ä½“æ¥è¯´æ€è·¯å¦‚ä¸‹:</p><p>1ã€å½“è°ƒç”¨<code>AllocateAligned</code>æˆ–<code>Allocate</code>æ—¶ï¼Œå…ˆåˆ¤æ–­å½“å‰åˆ†é…å†…å­˜å—ä¸­å‰©ä½™çš„å†…å­˜æ˜¯å¦æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ†é…æ–°çš„å†…å­˜ï¼ˆä»¥åŠè®¡ç®—å†…å­˜å¯¹é½ï¼‰ï¼›å¦‚æœè¶³ä»¥å®¹çº³ï¼Œåˆ™ç›´æ¥ä»å½“å‰å†…å­˜å—ä¸­æå–å†…å­˜ä½œä¸ºæ‰€éœ€å†…å­˜ä½¿ç”¨ã€‚è‹¥æ˜¯ä¸è¶³ä»¥å®¹çº³åˆ™è°ƒç”¨<code>AllocateFallback</code>å»ç”³è¯·å†…å­˜å¹¶åˆ†é…ã€‚</p><p>2ã€åœ¨<code>AllocateFallback</code>ä¸­ï¼Œå…ˆåˆ¤æ–­éœ€è¦ç”³è¯·çš„å†…å­˜æ˜¯å¦å¤§äº1Kï¼Œè‹¥æ˜¯å¤§äº1Kï¼Œç›´æ¥<code>AllocateNewBlock</code>å‘ç³»ç»Ÿç”³è¯·è¶³å¤Ÿçš„å†…å­˜ä»¥ä¾›ä½¿ç”¨ã€‚è‹¥æ˜¯å°äº1Kï¼Œåˆ™è°ƒç”¨<code>AllocateNewBlock</code>åˆ†é…ä¸€ä¸ªå—ï¼Œå¹¶åœ¨è¿™ä¸ªå—ä¸­åˆ†é…éœ€è¦çš„å†…å­˜ã€‚</p><p>3ã€<code>AllocateNewBlock</code>ä½¿ç”¨ç³»ç»Ÿnewæ“ä½œç¬¦å‘ç³»ç»Ÿç”³è¯·å†…å­˜ï¼Œå¹¶æ›´æ–°ç±»å†…å‚æ•°ã€‚å½“æ‰€åˆ†é…çš„å†…å­˜ä¸º4kbæ—¶ï¼Œä¼šå°†è¿™ä¸ªç”³è¯·çš„å†…å­˜ä½œä¸ºæ–°çš„å†…å­˜å—(æ­¤æ—¶æ—§çš„å†…å­˜å—ä¸­å³ä½¿è¿˜æœ‰å†…å­˜æœªä½¿ç”¨ï¼Œä¹Ÿä¸ä¼šå†æ‹¿æ¥ä½¿ç”¨ï¼Œå› ä¸ºalloc_ptr_ä¼šæŒ‡å‘æ–°ç”³è¯·çš„å†…å­˜å—)ã€‚ç„¶åå†å‘æ–°ç”³è¯·çš„å†…å­˜å—æå–å†…å­˜ä»¥ä¾›ä½¿ç”¨ã€‚</p><p>è¿™é‡ŒLevelå¯¹äºå°äº1Kçš„å†…å­˜ç”³è¯·æ‰å‘å†…å­˜æ± æå–å†…å­˜ï¼Œä¸»è¦æ˜¯è¿ç»­å¤šæ¬¡ç”³è¯·å°çš„å†…å­˜ä¼šå®¹æ˜“å¯¼è‡´å†…å­˜ç¢ç‰‡ï¼Œå½±å“ç³»ç»Ÿçš„æ€§èƒ½ã€‚å¹¶ä¸”å¤šæ¬¡çš„newå’Œdeleteæ¯”è¾ƒè€—æ—¶(ä¸æ–­çš„æ„é€ å’Œææ„)ï¼Œä¼šä»˜å‡ºé¢å¤–çš„ç©ºé—´å’Œæ—¶é—´ã€‚</p><hr><h2 id="æ€»ç»“éƒ¨åˆ†">æ€»ç»“éƒ¨åˆ†</h2><table><thead><tr class="header"><th style="text-align: center;">æ–¹æ³•/å˜é‡</th><th style="text-align: center;">ä½œç”¨</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">Arena()</td><td style="text-align: center;">æ„é€ å‡½æ•°</td></tr><tr class="even"><td style="text-align: center;">~Arena()</td><td style="text-align: center;">ææ„å‡½æ•°</td></tr><tr class="odd"><td style="text-align: center;">char* Allocate(size_t bytes)</td><td style="text-align: center;">æä¾›byteså¤§å°çš„å†…å­˜</td></tr><tr class="even"><td style="text-align: center;">char* AllocateAligned(size_t bytes)</td><td style="text-align: center;">æä¾›å†…å­˜å¯¹é½çš„byteså¤§å°çš„å†…å­˜</td></tr><tr class="odd"><td style="text-align: center;">size_t MemoryUsage() const</td><td style="text-align: center;">è¿”å›å½“å‰ç”³è¯·çš„å†…å­˜å¤§å°</td></tr><tr class="even"><td style="text-align: center;">char* AllocateFallback(size_tbytes)</td><td style="text-align: center;">å½“å—ä¸­å†…å­˜ä¸å¤Ÿæ—¶å‘ç³»ç»Ÿç”³è¯·å†…å­˜æ¥å£ï¼Œç”±Allocateæˆ–AllocateAlignedè°ƒç”¨</td></tr><tr class="odd"><td style="text-align: center;">char* AllocateNewBlock(size_tblock_bytes)</td><td style="text-align: center;">ç³»ç»Ÿnewçš„åŒ…è£…å‡½æ•°ï¼Œç”±AllocateFallbackè°ƒç”¨</td></tr><tr class="even"><td style="text-align: center;">alloc_ptr_</td><td style="text-align: center;">å½“å‰å†…å­˜å—ä¸­æœªä½¿ç”¨ç©ºé—´çš„é¦–åœ°å€</td></tr><tr class="odd"><td style="text-align: center;">alloc_bytes_remaining_</td><td style="text-align: center;">å½“å‰å†…å­˜å—ä¸­å‰©ä½™çš„ç©ºé—´</td></tr><tr class="even"><td style="text-align: center;">blocks_</td><td style="text-align: center;">newå‡ºæ¥çš„å†…å­˜çš„é¦–åœ°å€ç»„æˆçš„vectoræ•°ç»„</td></tr><tr class="odd"><td style="text-align: center;">memory_usage_</td><td style="text-align: center;">å‘ç³»ç»Ÿå·²ç”³è¯·çš„å†…å­˜å¤§å°</td></tr></tbody></table><div class="note note-primary">            <h3 id="ç¼–ç¨‹å°æŠ€å·§">ç¼–ç¨‹å°æŠ€å·§</h3><p><code>a &amp; (a - 1)</code>ï¼šå»æ‰aåœ¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸­æœ€å³è¾¹çš„1</p><p><code>A &amp; (B - 1) = A % B</code>ï¼šæ­¤å…¬å¼ä»…åœ¨Bæ˜¯2çš„å¹‚æ¬¡æ–¹æ—¶æˆç«‹</p>          </div>]]></content>
    
    
    <categories>
      
      <category>levelDBæºç å‰–æ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>levelDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>levelDBæºç å‰–æ(2)</title>
    <link href="/2022/08/29/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-2/"/>
    <url>/2022/08/29/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-2/</url>
    
    <content type="html"><![CDATA[<h2 id="åˆ†æleveldbçš„æ¶æ„">åˆ†ælevelDBçš„æ¶æ„</h2><span id="more"></span><hr><h3 id="leveldbçš„ç»„ä»¶">levelDBçš„ç»„ä»¶</h3><p>levelDBç”±ä»¥ä¸‹å‡ ä¸ªç»„ä»¶ç»„æˆï¼š<code>MemTable</code>ï¼Œ<code>Immutable MemTable</code>ï¼Œ<code>WAL</code>ï¼Œ<code>SSTable</code>ï¼Œ<code>Manifest</code>ï¼Œ<code>Current</code>ï¼Œ<code>Compaction</code></p><img src="/2022/08/29/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-2/pic1.jpg" class="" title="_"><div class="note note-primary">            <p><strong><em>MemTable</em></strong>ï¼šè¿™ä¸ªç»„ä»¶æ˜¯æ“ä½œçš„å…¥å£ï¼Œæ˜¯å¸¸é©»å†…å­˜çš„<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.375ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.97ex" role="img" focusable="false" viewBox="0 -705 1151.6 870.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></g></svg></mjx-container></span>æ ‘ï¼Œæ‰€æœ‰çš„å†™å…¥æ“ä½œéƒ½å°†è¢«ç›´æ¥å†™å…¥åˆ°æ­¤æ ‘ä¸­ã€‚å¦å¤–è¿™æ£µæ ‘æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾å’Œéå†ï¼Œä¹Ÿæ”¯æŒæ•°æ®åº“çš„æ“ä½œã€‚</p><p>å®ƒæœ¬èº«å°±å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼Œç›¸å½“äºlevelDBå†…ç½®çš„redisã€‚</p><p>å½“å…¶å ç”¨ç©ºé—´åˆ°è¾¾ä¸€ä¸ªé˜ˆå€¼æ—¶ï¼Œå°±è½¬æ¢æˆä¸€ä¸ª<code>Immutable MemTable</code>ä¾›åç»­åˆå¹¶ï¼ŒåŒæ—¶ç”Ÿæˆä¸€ä¸ªæ–°çš„<code>MemTable</code>æ¥ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</p>          </div><div class="note note-primary">            <p><strong><em>ImmutableMemTable</em></strong>ï¼šè¿™ä¸ªç»„ä»¶æ˜¯å†…å­˜ä¸ç£ç›˜çš„äº¤äº’ç»„ä»¶ã€‚å®ƒä¸<code>MemTable</code>å®Œå…¨ä¸€æ ·ï¼Œä»…ä»…åœ¨äºå…¶æ˜¯åªè¯»ç»“æ„ã€‚</p><p>å½“ç”Ÿæˆ<code>Immutable MemTable</code>åï¼Œåå°çº¿ç¨‹ä¼šå°†å…¶åˆ›å»ºå‡ºä¸€ä¸ª<code>SSTable</code>ï¼Œå¹¶å½’å¹¶åˆ°ç£ç›˜ä¸­ã€‚</p>          </div><div class="note note-primary">            <p><strong><em>WAL</em></strong>ï¼šå³write aheadlogï¼Œåœ¨å†™å…¥åˆ°æ•°æ®åº“ä¹‹å‰ï¼Œå…ˆå†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ã€‚</p><p>è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä¸ä¸¢å¤±æ•°æ®ï¼Œç”±äº<code>MemTable</code>ä½äºå†…å­˜ä¸­ï¼Œå†™å…¥ä¸€äº›æ•°æ®åï¼Œå…¶ä¸èƒ½ç«‹åˆ»åŒæ­¥åˆ°ç£ç›˜ä¸­ï¼Œå¦‚æœçªç„¶æ‰ç”µï¼Œè¿™æ ·å†™å…¥çš„æ•°æ®å°±ä¸¢å¤±äº†ã€‚è€Œ<code>WAL</code>ä½äºç£ç›˜ä¸­ï¼Œä¸è¿‡ç”±äºæ—¥å¿—ç»“æ„æ˜¯é¡ºåºå†™ï¼Œå› æ­¤å…¶å†™å…¥æ•ˆç‡ä¹Ÿæ˜¯å¾ˆé«˜çš„ã€‚</p><p>æ¯æ¬¡æ•°æ®åº“é‡å¯æ—¶éƒ½éœ€è¦è¯»å–æ—¥å¿—å¹¶è¿›è¡Œæ¢å¤ï¼Œå¦‚æœæ—¥å¿—ç»“æ„å¤ªå¤§ï¼Œå¯åŠ¨æ•°æ®åº“çš„é€Ÿåº¦å°±ä¼šå¾ˆæ…¢ã€‚</p>          </div><div class="note note-primary">            <p><strong><em>SSTable</em></strong>ï¼šå³Sorted StringTableã€‚è¿™æ˜¯æ¯”è¾ƒé‡è¦çš„ç»“æ„ï¼Œè™½ç„¶æ•°æ®åº“çš„è¯»å†™æ˜¯åŸºäº<code>MemTable</code>çš„ï¼Œä½†æ˜¯å…¶ä½äºå†…å­˜ä¸­ï¼Œå†…å­˜ä¸æ˜¯æ— é™å¤§çš„ï¼Œéœ€è¦è¢«æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ã€‚å½“åˆ›å»ºå‡º<code>Immutable MemTable</code>åï¼Œå°±ä¼šå¯¹å…¶åˆ›å»ºå‡ºä¸€ä¸ª<code>SSTable</code>æ¥ä¿å­˜æ•°æ®åˆ°ç£ç›˜ä¸Šã€‚</p><p>å…¶æœ‰åºä½“ç°åœ¨é”®æ˜¯æœ‰åºçš„ï¼ŒåŒæ—¶å„çº§çš„<code>SSTable</code>æ–‡ä»¶ä¹‹é—´ä¹Ÿæ˜¯æœ‰åºçš„ï¼Œå³é”®ä¸é‡å ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä¿æŒè‰¯å¥½çš„è¯»é€Ÿåº¦ã€‚ç”±äºlevelDBä¸éœ€è¦æ›´æ–°ç£ç›˜æ•°æ®ç»“æ„ï¼Œå› æ­¤ä¸éœ€è¦ä½¿ç”¨B+æ ‘ã€‚å½“æ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸Šé”®æœ‰åºï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨é«˜æ•ˆçš„äºŒåˆ†æŸ¥æ‰¾ï¼›è€Œé”®ä¸é‡å åˆ™é¿å…äºŒåˆ†æŸ¥æ‰¾è¯»å¤šä¸ªç£ç›˜å—ã€‚</p><p>åŒæ—¶ï¼Œå°†<code>MemTable</code>å†™å…¥åˆ°ç£ç›˜ä¸Šçš„<code>SSTable</code>åå°±å¯ä»¥é‡Šæ”¾æ‰è¿™éƒ¨åˆ†çš„æ—¥å¿—ç©ºé—´ï¼Œå‡å°‘ä¸‹æ¬¡å¯åŠ¨æ—¶çš„æ¢å¤é€Ÿåº¦ã€‚</p><p>ä½†æ˜¯å½“<code>SSTable</code>æ•°ç›®å˜å¤šæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´é”®çš„èŒƒå›´å‡ºç°é‡å ï¼Œè¿™æ—¶å€™å¯ä»¥è¿›è¡Œåˆå¹¶ï¼Œå°†å¤šä¸ªå°çš„<code>SSTable</code>åˆå¹¶æˆä¸€ä¸ªå¤§çš„ï¼Œç”±äº<code>SSTable</code>æ˜¯æœ‰åºçš„ï¼Œå…¶åˆå¹¶é€Ÿåº¦ä¹Ÿæ˜¯ååˆ†çš„å¿«ã€‚</p>          </div><div class="note note-primary">            <p><strong><em>Manifest</em></strong>ï¼šLevelDBä¸­æœ‰ç‰ˆæœ¬Versionçš„æ¦‚å¿µï¼Œä¸€ä¸ªç‰ˆæœ¬Versionä¸»è¦è®°å½•äº†æ¯ä¸€å±‚Levelä¸­æ‰€æœ‰æ–‡ä»¶çš„å…ƒæ•°æ®ã€‚éšç€Compactionçš„è¿›è¡Œï¼Œå…ƒæ•°æ®ä¼šæ”¹å˜ï¼Œæ‰€ä»¥æ¯æ¬¡è¿˜éœ€è¦å°†æ”¹å˜çš„å…ƒæ•°æ®å†™åˆ°MANIFESTä¸­ã€‚</p>          </div><div class="note note-primary">            <p><strong><em>Current</em></strong>ï¼šæœ¬æ–‡ä»¶æŒ‡å‘å½“å‰çš„<code>Manifest</code>æ–‡ä»¶ï¼Œç”±äºå¯èƒ½å­˜åœ¨å¤šä¸ª<code>Manifest</code>æ–‡ä»¶ï¼Œ<code>Current</code>æ–‡ä»¶æŒ‡å‘æˆ‘ä»¬å½“å‰éœ€è¦ç”¨åˆ°çš„<code>Manifest</code>æ–‡ä»¶ã€‚</p>          </div><div class="note note-primary">            <p><strong><em>Compaction</em></strong>ï¼šä½œç”¨æ˜¯å°†å¤šä¸ªå°çš„<code>SSTable</code>åˆå¹¶æˆä¸€ä¸ªå¤§çš„<code>SSTable</code>ã€‚è¿™æ ·å¯ä»¥è§£å†³æŸ¥æ‰¾çš„æ•ˆç‡é—®é¢˜ã€‚</p><p>æ¯ä¸ªå¤§çš„<code>SSTable</code>æ˜¯é”®æœ‰åºçš„ï¼Œå¯ä»¥å°†å…¶å†æ¬¡åˆ†æˆå¤šä¸ªå°çš„é”®ä¸é‡å çš„<code>SSTable</code>ï¼Œè¿™æ ·æ¯æ¬¡åˆå¹¶æ—¶åªéœ€è¦åˆå¹¶å°çš„<code>SSTable</code>å³å¯ï¼Œè€Œä¸éœ€è¦å»è¯»å–ä¸€ä¸ªå¾ˆå¤§çš„<code>SSTable</code>ã€‚</p><p>å¦å¤–ï¼Œç”±äº<code>level-0</code>æ˜¯ç›´æ¥ç”±å†…å­˜å†™å…¥çš„ï¼Œå…¶å¤šä¸ª<code>SSTable</code>å¯èƒ½å­˜åœ¨é”®é‡å ç°è±¡ï¼Œä½†æ˜¯æ›´é«˜å±‚çš„<code>level</code>æ˜¯ä¸å­˜åœ¨é”®é‡å ç°è±¡çš„ã€‚</p>          </div>]]></content>
    
    
    <categories>
      
      <category>levelDBæºç å‰–æ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>levelDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TODO</title>
    <link href="/2022/08/28/TODO/"/>
    <url>/2022/08/28/TODO/</url>
    
    <content type="html"><![CDATA[<p>åšå®¢è¡¥å…¨è®¡åˆ’...</p><span id="more"></span><p>ç›®å‰ï¼Œæœ¬åšå®¢åˆšåˆšå»ºæˆï¼Œå› æ­¤åç»­æ‰“ç®—å°†ä¹‹å‰çš„ç¬”è®°è½¬ç§»åˆ°æ­¤åšå®¢ä¸Šï¼Œä»è€Œå½¢æˆä¸€ä¸ªæ¯”è¾ƒé›†ä¸­çš„ç®¡ç†ã€‚</p><h5 id="é«˜ä¼˜å…ˆçº§éƒ¨åˆ†">é«˜ä¼˜å…ˆçº§éƒ¨åˆ†</h5><ul class="task-list"><li><input type="checkbox" disabled="">levelDBæºç å‰–æ</li><li><input type="checkbox" disabled="">CSAPPè¯»ä¹¦ç¬”è®°è½¬ç§»</li></ul><h5 id="ä¸­ä¼˜å…ˆçº§éƒ¨åˆ†">ä¸­ä¼˜å…ˆçº§éƒ¨åˆ†</h5><ul class="task-list"><li><input type="checkbox" disabled="">SICPè¯»ä¹¦ç¬”è®°è½¬ç§»</li><li><input type="checkbox" disabled="">OpenCVæºç å‰–æ</li><li><input type="checkbox" disabled="">ä¸€äº›çš„å·¥å…·ä½¿ç”¨ä¸å¼€å‘</li></ul><h5 id="ä½ä¼˜å…ˆçº§éƒ¨åˆ†">ä½ä¼˜å…ˆçº§éƒ¨åˆ†</h5><ul class="task-list"><li><input type="checkbox" disabled="">æœºå™¨å­¦ä¹ ä¸­çš„ç¬”è®°</li><li><input type="checkbox" disabled="">pythonçˆ¬è™«éƒ¨åˆ†ï¼Œæ¶‰åŠxpathã€reã€scrapyã€seleniumã€splashã€ä»£ç†æ± ç­‰ç­‰</li><li><input type="checkbox" disabled="">è®¡ç®—æœºç½‘ç»œéƒ¨åˆ†ç¬”è®°</li><li><input type="checkbox" disabled="">Notabilityä¸Šçš„æ‰‹å†™ç¬”è®°è½¬æˆmdæ ¼å¼å­˜å‚¨</li></ul>]]></content>
    
    
    <categories>
      
      <category>å…¶ä»–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>others</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>levelDBæºç å‰–æ(1)</title>
    <link href="/2022/08/28/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-1/"/>
    <url>/2022/08/28/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-1/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è¿°leveldbé¡¹ç›®ç»“æ„">æ¦‚è¿°levelDBé¡¹ç›®ç»“æ„</h2><span id="more"></span><hr><p><em><a href="https://zhuanlan.zhihu.com/p/203578801">å‚è€ƒ1</a></em></p><p><em><a href="https://zhuanlan.zhihu.com/p/436037845">å‚è€ƒ2</a></em></p><p><em><a href="https://github.com/google/leveldb">é¡¹ç›®åœ°å€</a></em></p><hr><h3 id="leveldbé¡¹ç›®æ¦‚è¿°">levelDBé¡¹ç›®æ¦‚è¿°</h3><p>levelDBæ˜¯ä¸€ä¸ªæŒä¹…åŒ–<code>kv</code>å­˜å‚¨æ•°æ®åº“ï¼Œ<code>kv</code>å‡ä¸ºä»»æ„çš„å­—èŠ‚æ•°ç»„ã€‚</p><p>å…¶éšæœºå†™ã€é¡ºåºå†™/è¯»çš„æ€§èƒ½å¾ˆé«˜ï¼Œä½†æ˜¯éšæœºè¯»çš„æ€§èƒ½ä¸€èˆ¬ã€‚</p><h4 id="lsm-tree">LSM Tree</h4><p>å…¶å®ç°åŸç†ä¸º<code>LSM Tree</code>ï¼Œç®€å•æ¥è¯´å°±æ˜¯è®²ç£ç›˜çš„éšæœºå†™è½¬æ¢æˆé¡ºåºå†™.</p><p>ç”±äºç£ç›˜çš„å¯»å€éå¸¸è€—æ—¶ï¼Œå› æ­¤é¡ºåºå†™çš„é€Ÿåº¦è¿œè¿œè¶…è¿‡éšæœºå†™.</p><p><code>LSM Tree</code>ç”±ä¸¤éƒ¨åˆ†ç»„æˆåˆ†åˆ«æ˜¯<code>Log structed</code>å’Œ<code>Merge Tree</code>.</p><p>å…¶ä¸­<code>Log structed</code>æ˜¯æ—¥å¿—ç»“æ„ï¼Œè€Œæ—¥å¿—æœ¬èº«æ˜¯ä¸ä¼šä¿®æ”¹çš„ï¼Œåªéœ€è¦è¿½åŠ å†™.</p><p><code>Merge Tree</code>æ˜¯åˆå¹¶æ ‘ï¼Œå³å°†å¤šä¸ªæ ‘åˆå¹¶æˆä¸€ä¸ªæ›´å¤§çš„æ ‘.</p><p><em>æ‰€ä»¥ï¼Œ<code>LSM Tree</code>æ˜¯æ•°æ®ä»¥è¿½åŠ å†™çš„æ–¹å¼å†™å…¥æ–‡ä»¶ï¼Œæˆä¸ºä¸€é¢—å°æ ‘ï¼Œç„¶ååˆå¹¶æˆæ›´å¤§çš„æ ‘.</em></p><p>åœ¨<code>LSM Tree</code>ä¸­ï¼Œ<strong>æ›´æ–°ä¸€ä¸ªæ•°æ®ä¸éœ€è¦ä¿®æ”¹è¿‡å»çš„æ—§æ•°æ®</strong>ï¼Œä½†æ˜¯æ­¤æ—¶ï¼Œ<br>å…¶å†™çš„æ€§èƒ½å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯éœ€è¦æ”¯ä»˜é¢å¤–çš„å­˜å‚¨ç©ºé—´æ¥ä½œä¸ºä»£ä»·ã€‚ä¸ºäº†åŒæ­¥æå‡å…¶è¯»çš„æ€§èƒ½ï¼ŒlevelDBä¹ŸåŒæ ·æ”¯ä»˜äº†ä¸€äº›å­˜å‚¨ç©ºé—´ä½œä¸ºè¯»æ€§èƒ½æå‡çš„ä»£ä»·ã€‚</p><p>å…·ä½“è€Œè¨€ï¼Œå°†ç´¢å¼•æ ‘ç»“æ„æ‹†åˆ†æˆå¤šä¸ªå¤§å°é€æ¸å˜å¤§çš„ç»“æ„<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.375ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.97ex" role="img" focusable="false" viewBox="0 -705 1151.6 870.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></g></svg></mjx-container></span>ã€<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.339ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.934ex" role="img" focusable="false" viewBox="0 -705 1151.6 855"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g></svg></mjx-container></span>...<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.765ex" height="1.952ex" role="img" focusable="false" viewBox="0 -705 1222.3 862.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mi" transform="translate(748,-150) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container></span>ï¼Œå…¶å‡ä¸ºæœ‰åºçš„ã€‚</p><p>æœ€å°çš„<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.375ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.97ex" role="img" focusable="false" viewBox="0 -705 1151.6 870.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></g></svg></mjx-container></span>ä½äºå†…å­˜ï¼Œæ˜¯æ‰€æœ‰æ“ä½œæ•°æ®çš„è½è„šç‚¹ï¼Œä¿å­˜äº†æœ€è¿‘å†™å…¥çš„kvï¼Œå…¶ä¹Ÿå¯ä»¥éšæ—¶åŸåœ°æ›´æ–°ï¼Œæ”¯æŒéšæ—¶æŸ¥è¯¢ã€‚</p><img src="/2022/08/28/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-1/pic1.jpg" class="" title="_"><p>å…¶ä½™çš„<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.339ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.934ex" role="img" focusable="false" viewBox="0 -705 1151.6 855"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g></svg></mjx-container></span>...<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.765ex" height="1.952ex" role="img" focusable="false" viewBox="0 -705 1222.3 862.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mi" transform="translate(748,-150) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container></span>å‡ä½äºç£ç›˜ä¸­ï¼Œä½†æ˜¯æ¯æ£µæ ‘ä¹Ÿæ˜¯æœ‰åºçš„ã€‚</p><p><strong><em>å½“æ‰§è¡Œå†™æ“ä½œæ—¶</em></strong>ï¼šé¦–å…ˆå°†æ•°æ®åŠ å…¥åˆ°<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.375ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.97ex" role="img" focusable="false" viewBox="0 -705 1151.6 870.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></g></svg></mjx-container></span>å±‚ç´¢å¼•æ ‘ä¸­ï¼Œå½“<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.375ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.97ex" role="img" focusable="false" viewBox="0 -705 1151.6 870.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></g></svg></mjx-container></span>å±‚æ•°æ®å¤§å°è¾¾åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œä¼šæ‰§è¡Œ<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.375ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.97ex" role="img" focusable="false" viewBox="0 -705 1151.6 870.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></g></svg></mjx-container></span>ä¸<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.339ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.934ex" role="img" focusable="false" viewBox="0 -705 1151.6 855"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g></svg></mjx-container></span>å±‚çš„åˆå¹¶ã€‚ç”±äºä¸¤è€…å‡ä¸ºæœ‰åºçš„ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼ä¸€ä¸ªå½’å¹¶ï¼Œè€Œå½’å¹¶è¿™ä¸ªæ“ä½œåªéœ€è¦ç”¨åˆ°æœ‰åºå†™ï¼Œåˆå¹¶å‡ºæ¥çš„æ–°çš„<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.339ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.934ex" role="img" focusable="false" viewBox="0 -705 1151.6 855"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g></svg></mjx-container></span>ä¼šå–ä»£æ‰æ—§çš„<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.339ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.934ex" role="img" focusable="false" viewBox="0 -705 1151.6 855"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g></svg></mjx-container></span>ï¼Œå½“<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.339ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.934ex" role="img" focusable="false" viewBox="0 -705 1151.6 855"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g></svg></mjx-container></span>åˆ°è¾¾æŒ‡å®šå¤§å°åï¼Œä¹Ÿä¼šåŒæ ·å‘ååˆå¹¶ã€‚</p><img src="/2022/08/28/levelDB%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-1/pic2.jpg" class="" title="_"><p><strong><em>å½“æ‰§è¡Œè¯»æ“ä½œæ—¶</em></strong>ï¼šåœ¨<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.375ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.97ex" role="img" focusable="false" viewBox="0 -705 1151.6 870.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></g></svg></mjx-container></span>ã€<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.339ex;" xmlns="http://www.w3.org/2000/svg" width="2.605ex" height="1.934ex" role="img" focusable="false" viewBox="0 -705 1151.6 855"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mn" transform="translate(748,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g></svg></mjx-container></span>...<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.765ex" height="1.952ex" role="img" focusable="false" viewBox="0 -705 1222.3 862.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mi" transform="translate(748,-150) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container></span>ä¸­é€å±‚æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ï¼Œå› æ­¤ï¼Œå³ä½¿æ•°æ®æ²¡æœ‰æ›´æ–°åˆ°è¾ƒé«˜çš„å±‚ä¸­ï¼Œä¹Ÿä¸å½±å“æ•°æ®çš„æ­£ç¡®æ€§ã€‚</p><p>å½“ç„¶ï¼ŒlevelDBå…·ä½“çš„å®ç°è¿˜æ˜¯å­˜åœ¨ä¸€äº›ç»†èŠ‚çš„ã€‚</p><hr><h3 id="leveldbçš„é¡¹ç›®ç»“æ„">levelDBçš„é¡¹ç›®ç»“æ„</h3><h4 id="ä¸€äº›å¤´æ–‡ä»¶åŠå…¶ä½œç”¨">ä¸€äº›å¤´æ–‡ä»¶åŠå…¶ä½œç”¨</h4><p><code>include</code>: å‡½æ•°åº“çš„å¤´æ–‡ä»¶</p><p><code>port</code>: å¯ç§»æ¤æ€§ç›¸å…³çš„åŠŸèƒ½</p><p><code>util</code>: é¡¹ç›®ç”¨åˆ°çš„ä¸€äº›åŠŸèƒ½å‡½æ•°</p><p><code>table</code>: SSTableçš„å®ç°</p><p><code>helpers/memenv</code>ï¼šç®€å•å®Œå…¨å†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæä¾›æ“ä½œç›®å½•æ–‡ä»¶æ¥å£</p><p><code>benchmarks</code>ï¼šæ€§èƒ½æµ‹è¯•ç›¸å…³ä»£ç </p><p><code>db</code>:æ•°æ®åº“å®ç°ï¼Œç‰ˆæœ¬ç®¡ç†ï¼ŒCompactionï¼ŒWALå’ŒMemTableå®ç°</p><h4 id="æ¥å£æ–‡ä»¶çš„å¯¹åº”åŠŸèƒ½">æ¥å£æ–‡ä»¶çš„å¯¹åº”åŠŸèƒ½</h4><p><code>cache.h</code>:ç¼“å­˜æ¥å£ï¼Œæä¾›äº†é»˜è®¤çš„LRUç¼“å­˜ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®ç°ç¼“å­˜</p><p><code>comparator.h</code>:å®šä»¥æ•°æ®åº“æ¯”è¾ƒå™¨çš„æ¥å£ï¼Œç”¨æ¥æ¯”è¾ƒé”®ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤çš„åŸºäºå­—èŠ‚çš„æ¯”è¾ƒï¼Œå¯ä»¥å®šä¹‰è‡ªå·±çš„æ¯”è¾ƒå™¨</p><p><code>dumpfile.h</code>: ä»¥å¯è¯»æ–‡æœ¬å½¢å¼å¯¼å‡ºä¸€ä¸ªæ–‡ä»¶ï¼Œè°ƒè¯•ä½¿ç”¨</p><p><code>export.h</code>: å¯ç§»æ¤æ€§ç›¸å…³</p><p><code>iterator.h</code>: è¿­ä»£å™¨æ¥å£</p><p><code>slice.h</code>: å®ç°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå­˜å‚¨æŒ‡é’ˆå’Œé•¿åº¦ï¼ŒæŒ‡å‘å­—ç¬¦ä¸²</p><p><code>table_builder.h</code>: æ„é€ ä¸€ä¸ªSSTable</p><p><code>write_batch.h</code>: å®ç°æ‰¹é‡å†™å…¥çš„æ¥å£</p><p><code>c.h</code>: å®ç°Cè¯­è¨€ç›¸å…³çš„æ¥å£</p><p><code>db.h</code>: æ“ä½œæ•°æ®åº“çš„ä¸»è¦æ¥å£</p><p><code>env.h</code>: å®šä¹‰æ“ä½œç³»ç»Ÿç›¸å…³çš„åŠŸèƒ½ï¼Œå¦‚è¯»å†™æ–‡ä»¶ä¹‹ç±»çš„</p><p><code>filter_policy.h</code>: å®šä¹‰å¸ƒéš†è¿‡æ»¤å™¨æ¥å£</p><p><code>options.h</code>: é…ç½®é€‰é¡¹</p><p><code>status.h</code>: å®šä¹‰æ•°æ®åº“æ“ä½œçš„è¿”å›çŠ¶æ€</p><p><code>table.h</code>: SSTableç›¸å…³çš„æ¥å£</p>]]></content>
    
    
    <categories>
      
      <category>levelDBæºç å‰–æ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>levelDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
